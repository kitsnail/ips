import{u as c}from"./api-6KZm3PBg.js";import{d as G,P as H,l as L,q as g,t as l,v as o,B as R,c as J,r as p,A as m,a as u,R as K,o as B,z as r,G as D,S as O}from"./element-plus-BmLo4b4r.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"admin-users"},X={class:"page-header"},Y={class:"table-container"},Z={class:"pagination-wrapper"},h=G({__name:"AdminUsersView",setup(ee){const k=p([]),s=p(!1),w=p(!1),_=p(!1),y=p(null),n=p({username:"",password:"",role:"viewer"}),d=p({page:1,pageSize:20,total:0}),v=async()=>{try{s.value=!0;const t=await c.list();k.value=t,d.value.total=t.length}catch(t){m.error("加载用户列表失败"),console.error(t)}finally{s.value=!1}},A=async()=>{try{s.value=!0,await c.create(n.value),m.success("用户创建成功"),w.value=!1,n.value={username:"",password:"",role:"viewer"},v()}catch{m.error("创建用户失败")}finally{s.value=!1}},E=async()=>{if(y.value)try{s.value=!0,await c.update(y.value.id,{role:n.value.role}),m.success("用户更新成功"),_.value=!1,y.value=null,v()}catch{m.error("更新用户失败")}finally{s.value=!1}},$=t=>{y.value=t,n.value={username:t.username,password:"",role:t.role},_.value=!0},q=async t=>{try{await O.confirm(`确定要删除用户 "${t.username}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),s.value=!0,await c.delete(t.id),m.success("用户删除成功"),v()}catch(e){e!=="cancel"&&m.error("删除用户失败")}finally{s.value=!1}},M=t=>{d.value.page=t,v()},P=t=>{d.value.pageSize=t,d.value.page=1,v()},x=()=>{n.value={username:"",password:"",role:"viewer"}};return H(()=>{v()}),(t,e)=>{const i=u("el-button"),V=u("el-table-column"),N=u("el-tag"),T=u("el-table"),I=u("el-pagination"),b=u("el-input"),f=u("el-form-item"),C=u("el-radio"),z=u("el-radio-group"),U=u("el-form"),S=u("el-dialog"),j=K("loading");return B(),L("div",W,[g("div",X,[e[14]||(e[14]=g("h1",null,"用户管理",-1)),l(i,{type:"primary",onClick:e[0]||(e[0]=a=>w.value=!0)},{default:o(()=>[...e[13]||(e[13]=[g("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[g("path",{d:"M12 4v16m8-8H4m0 0l3-3m0 3v12h2m0 0l-3 3",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),r(" 创建用户 ",-1)])]),_:1})]),g("div",Y,[R((B(),J(T,{data:k.value,style:{width:"100%"}},{default:o(()=>[l(V,{prop:"id",label:"ID",width:"80"}),l(V,{prop:"username",label:"用户名",width:"150"}),l(V,{prop:"role",label:"角色",width:"100"},{default:o(({row:a})=>[l(N,{type:a.role==="admin"?"danger":"info",size:"small"},{default:o(()=>[r(D(a.role==="admin"?"管理员":"查看者"),1)]),_:2},1032,["type"])]),_:1}),l(V,{prop:"createdAt",label:"创建时间",width:"180"},{default:o(({row:a})=>[r(D(new Date(a.createdAt).toLocaleString()),1)]),_:1}),l(V,{label:"操作",width:"200",fixed:"right"},{default:o(({row:a})=>[l(i,{size:"small",onClick:F=>$(a)},{default:o(()=>[...e[15]||(e[15]=[r("编辑",-1)])]),_:1},8,["onClick"]),l(i,{size:"small",type:"danger",onClick:F=>q(a)},{default:o(()=>[...e[16]||(e[16]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[j,s.value]]),g("div",Z,[l(I,{"current-page":d.value.page,"onUpdate:currentPage":e[1]||(e[1]=a=>d.value.page=a),"page-size":d.value.pageSize,"onUpdate:pageSize":e[2]||(e[2]=a=>d.value.pageSize=a),"page-sizes":[10,20,50,100],total:d.value.total,layout:"sizes, prev, pager, next, total",background:!0,onSizeChange:P,onCurrentChange:M},null,8,["current-page","page-size","total"])])]),l(S,{modelValue:w.value,"onUpdate:modelValue":e[7]||(e[7]=a=>w.value=a),title:"创建用户",width:"500px",onClose:x},{footer:o(()=>[l(i,{onClick:e[6]||(e[6]=a=>w.value=!1)},{default:o(()=>[...e[19]||(e[19]=[r("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:A,loading:s.value},{default:o(()=>[...e[20]||(e[20]=[r("创建",-1)])]),_:1},8,["loading"])]),default:o(()=>[l(U,{"label-width":"100px"},{default:o(()=>[l(f,{label:"用户名",required:""},{default:o(()=>[l(b,{modelValue:n.value.username,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.username=a),placeholder:"输入用户名"},null,8,["modelValue"])]),_:1}),l(f,{label:"密码",required:""},{default:o(()=>[l(b,{modelValue:n.value.password,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.password=a),type:"password",placeholder:"输入密码","show-password":""},null,8,["modelValue"])]),_:1}),l(f,{label:"角色",required:""},{default:o(()=>[l(z,{modelValue:n.value.role,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.role=a)},{default:o(()=>[l(C,{value:"viewer"},{default:o(()=>[...e[17]||(e[17]=[r("查看者",-1)])]),_:1}),l(C,{value:"admin"},{default:o(()=>[...e[18]||(e[18]=[r("管理员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(S,{modelValue:_.value,"onUpdate:modelValue":e[12]||(e[12]=a=>_.value=a),title:"编辑用户",width:"500px",onClose:x},{footer:o(()=>[l(i,{onClick:e[11]||(e[11]=a=>_.value=!1)},{default:o(()=>[...e[23]||(e[23]=[r("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:E,loading:s.value},{default:o(()=>[...e[24]||(e[24]=[r("保存",-1)])]),_:1},8,["loading"])]),default:o(()=>[l(U,{"label-width":"100px"},{default:o(()=>[l(f,{label:"用户名"},{default:o(()=>[l(b,{modelValue:n.value.username,"onUpdate:modelValue":e[8]||(e[8]=a=>n.value.username=a),disabled:"",placeholder:"用户名"},null,8,["modelValue"])]),_:1}),l(f,{label:"新密码"},{default:o(()=>[l(b,{modelValue:n.value.password,"onUpdate:modelValue":e[9]||(e[9]=a=>n.value.password=a),type:"password",placeholder:"留空则不修改","show-password":""},null,8,["modelValue"])]),_:1}),l(f,{label:"角色",required:""},{default:o(()=>[l(z,{modelValue:n.value.role,"onUpdate:modelValue":e[10]||(e[10]=a=>n.value.role=a)},{default:o(()=>[l(C,{value:"viewer"},{default:o(()=>[...e[21]||(e[21]=[r("查看者",-1)])]),_:1}),l(C,{value:"admin"},{default:o(()=>[...e[22]||(e[22]=[r("管理员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),te=Q(h,[["__scopeId","data-v-9af38b38"]]);export{te as default};
