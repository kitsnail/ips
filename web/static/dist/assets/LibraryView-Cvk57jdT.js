import{l as _}from"./index-azKvCBLj.js";import{d as L,A as M,H as N,I as P,a as j,b as f,f as t,w as o,r as p,E as s,i as r,J as q,o as H,j as g,D as w,K as x}from"./element-plus-DT46MLQ6.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"library"},T={class:"header"},F={class:"actions"},G={style:{"font-family":"monospace",color:"#0891b2"}},O={style:{display:"flex","justify-content":"center","margin-top":"20px"}},Q=L({__name:"LibraryView",setup(R){const y=p(!1),b=p([]),n=p({page:1,pageSize:10,total:0}),m=p(!1),i=p([]),d=p({name:"",image:""}),u=async()=>{try{y.value=!0;const l=(n.value.page-1)*n.value.pageSize,e=await _.list({limit:n.value.pageSize,offset:l});b.value=e.images,n.value.total=e.total||e.images.length}catch{s.error("加载镜像库失败")}finally{y.value=!1}},z=async()=>{try{await _.create(d.value),s.success("镜像添加成功"),m.value=!1,d.value={name:"",image:""},u()}catch{s.error("添加镜像失败")}},S=async l=>{try{await x.confirm("确定要删除这个镜像吗？","确认删除",{type:"warning"}),await _.delete(l.id),s.success("镜像已删除"),u()}catch(e){e!=="cancel"&&s.error("删除失败")}},V=async()=>{if(i.value.length===0){s.warning("请先选择要删除的镜像");return}try{await x.confirm(`确定要删除选中的 ${i.value.length} 个镜像吗？`,"确认删除",{type:"warning"});for(const l of i.value)await _.delete(l);s.success(`成功删除 ${i.value.length} 个镜像`),i.value=[],u()}catch(l){l!=="cancel"&&s.error("批量删除失败")}},k=l=>{n.value.page=l,u()},A=l=>{n.value.pageSize=l,n.value.page=1,u()},D=l=>{l?i.value=b.value.map(e=>e.id):i.value=[]};return M(()=>{u()}),N(()=>{}),(l,e)=>{const c=r("el-button"),v=r("el-table-column"),U=r("el-table"),B=r("el-pagination"),h=r("el-input"),C=r("el-form-item"),I=r("el-form"),$=r("el-dialog"),E=q("loading");return P((H(),j("div",K,[f("div",T,[e[9]||(e[9]=f("h2",null,"镜像库管理",-1)),f("div",F,[t(c,{type:"danger",disabled:i.value.length===0,onClick:V},{default:o(()=>[g(" 批量删除 ("+w(i.value.length)+") ",1)]),_:1},8,["disabled"]),t(c,{type:"primary",onClick:e[0]||(e[0]=a=>m.value=!0)},{default:o(()=>[...e[8]||(e[8]=[g(" 添加镜像 ",-1)])]),_:1})])]),t(U,{data:b.value,onSelectionChange:e[1]||(e[1]=a=>i.value=a),style:{width:"100%"}},{default:o(()=>[t(v,{type:"selection",width:"55",onSelectAll:D}),t(v,{prop:"name",label:"显示名称",width:"200"}),t(v,{prop:"image",label:"镜像地址","min-width":"300"},{default:o(({row:a})=>[f("span",G,w(a.image),1)]),_:1}),t(v,{prop:"createdAt",label:"添加时间",width:"180"},{default:o(({row:a})=>[g(w(new Date(a.createdAt).toLocaleString()),1)]),_:1}),t(v,{label:"操作",width:"100",fixed:"right"},{default:o(({row:a})=>[t(c,{size:"small",type:"danger",onClick:W=>S(a)},{default:o(()=>[...e[10]||(e[10]=[g(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),f("div",O,[t(B,{"current-page":n.value.page,"onUpdate:currentPage":e[2]||(e[2]=a=>n.value.page=a),"page-size":n.value.pageSize,"onUpdate:pageSize":e[3]||(e[3]=a=>n.value.pageSize=a),"page-sizes":[10,20,50],total:n.value.total,layout:"sizes, prev, pager, next, total",background:!0,onSizeChange:A,onCurrentChange:k},null,8,["current-page","page-size","total"])]),t($,{modelValue:m.value,"onUpdate:modelValue":e[7]||(e[7]=a=>m.value=a),title:"添加镜像",width:"500px"},{footer:o(()=>[t(c,{onClick:e[6]||(e[6]=a=>m.value=!1)},{default:o(()=>[...e[11]||(e[11]=[g("取消",-1)])]),_:1}),t(c,{type:"primary",onClick:z},{default:o(()=>[...e[12]||(e[12]=[g("添加",-1)])]),_:1})]),default:o(()=>[t(I,{"label-width":"100px"},{default:o(()=>[t(C,{label:"显示名称",required:""},{default:o(()=>[t(h,{modelValue:d.value.name,"onUpdate:modelValue":e[4]||(e[4]=a=>d.value.name=a),placeholder:"例如：Nginx"},null,8,["modelValue"])]),_:1}),t(C,{label:"镜像地址",required:""},{default:o(()=>[t(h,{modelValue:d.value.image,"onUpdate:modelValue":e[5]||(e[5]=a=>d.value.image=a),placeholder:"docker.io/library/nginx:latest"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[E,y.value]])}}}),ee=J(Q,[["__scopeId","data-v-8c05f07a"]]);export{ee as default};
