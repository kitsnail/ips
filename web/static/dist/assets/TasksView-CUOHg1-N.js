import{t as h}from"./api-6KZm3PBg.js";import{d as E,Q as P,R as A,l as y,q as g,c as b,v as l,H as w,B as N,t as n,r as _,A as c,a as d,S as U,o as m,z as i,G as u,U as z}from"./element-plus-K37pJI3g.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";const j={class:"tasks"},q={class:"header"},F={class:"header-right"},G={key:0},H={style:{display:"flex","justify-content":"center","margin-top":"20px"}},L=E({__name:"TasksView",setup(Q){const k=_([]),f=_(!1),o=_([]),s=_({page:1,pageSize:10,total:0}),p=async()=>{try{f.value=!0;const a=(s.value.page-1)*s.value.pageSize,e=await h.list({limit:s.value.pageSize,offset:a});k.value=e.tasks,s.value.total=e.total||e.tasks.length}catch{c.error("加载任务失败")}finally{f.value=!1}},x=a=>{s.value.page=a,p()},C=a=>{s.value.pageSize=a,s.value.page=1,p()},S=async a=>{try{await z.confirm("确定要删除这个任务吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await h.delete(a.taskId),c.success("任务已删除"),p()}catch(e){e!=="cancel"&&(console.error("Delete task error:",e),c.error(`删除失败: ${e instanceof Error?e.message:"未知错误"}`))}},B=async()=>{if(o.value.length===0){c.warning("请选择要删除的任务");return}try{await z.confirm(`确定要删除选中的 ${o.value.length} 个任务吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=o.value.map(e=>h.delete(e.taskId));await Promise.all(a),c.success(`成功删除了 ${a.length} 个任务`),o.value=[],p()}catch(a){a!=="cancel"&&(console.error("Bulk delete error:",a),c.error(`批量删除失败: ${a instanceof Error?a.message:"未知错误"}`))}};return P(()=>{p()}),A(()=>{}),(a,e)=>{const v=d("el-button"),r=d("el-table-column"),T=d("el-tag"),D=d("router-link"),I=d("el-table"),V=d("el-pagination"),$=U("loading");return m(),y("div",j,[g("div",q,[e[3]||(e[3]=g("h2",null,"任务管理",-1)),g("div",F,[o.value.length>0?(m(),b(v,{key:0,type:"danger",onClick:B,disabled:o.value.length===0},{default:l(()=>[i(" 批量删除 ("+u(o.value.length)+") ",1)]),_:1},8,["disabled"])):w("",!0)])]),N((m(),b(I,{data:k.value,style:{width:"100%"},onSelectionChange:e[0]||(e[0]=t=>o.value=t)},{default:l(()=>[n(r,{type:"selection",width:"55"}),n(r,{prop:"taskId",label:"任务ID",width:"180"}),n(r,{prop:"status",label:"状态",width:"100"},{default:l(({row:t})=>[n(T,{type:t.status==="completed"?"success":t.status==="failed"?"danger":"info"},{default:l(()=>[i(u(t.status),1)]),_:2},1032,["type"])]),_:1}),n(r,{prop:"images",label:"镜像"},{default:l(({row:t})=>[i(u(t.images[0])+" ",1),t.images.length>1?(m(),y("span",G,"+"+u(t.images.length-1),1)):w("",!0)]),_:1}),n(r,{prop:"progress.percentage",label:"进度",width:"120"},{default:l(({row:t})=>[i(u(t.progress?.percentage?.toFixed(1)||0)+"% ",1)]),_:1}),n(r,{prop:"createdAt",label:"创建时间",width:"180"},{default:l(({row:t})=>[i(u(new Date(t.createdAt).toLocaleString()),1)]),_:1}),n(r,{label:"操作",width:"200"},{default:l(({row:t})=>[n(D,{to:`/tasks/${t.taskId}`},{default:l(()=>[n(v,{size:"small"},{default:l(()=>[...e[4]||(e[4]=[i("详情",-1)])]),_:1})]),_:1},8,["to"]),n(v,{size:"small",type:"danger",onClick:R=>S(t)},{default:l(()=>[...e[5]||(e[5]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[$,f.value]]),g("div",H,[n(V,{"current-page":s.value.page,"onUpdate:currentPage":e[1]||(e[1]=t=>s.value.page=t),"page-size":s.value.pageSize,"onUpdate:pageSize":e[2]||(e[2]=t=>s.value.pageSize=t),"page-sizes":[10,20,50],total:s.value.total,layout:"sizes, prev, pager, next, total",background:!0,onSizeChange:C,onCurrentChange:x},null,8,["current-page","page-size","total"])])])}}}),W=M(L,[["__scopeId","data-v-5bcb55b5"]]);export{W as default};
