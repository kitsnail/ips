import{b as w}from"./index-BE6ap8Ug.js";import{d as M,A as N,H as P,I as j,a as H,b as f,f as l,w as o,r as m,E as d,i,J as I,o as J,j as c,D as h,K as S}from"./element-plus-DT46MLQ6.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const L={class:"secrets"},T={class:"header"},F={class:"actions"},G={style:{"font-family":"monospace",color:"#0891b2"}},O={style:{display:"flex","justify-content":"center","margin-top":"20px"}},Q=M({__name:"SecretsView",setup(R){const b=m(!1),V=m([]),n=m({page:1,pageSize:10,total:0}),g=m(!1),s=m([]),r=m({name:"",registry:"",username:"",password:""}),u=async()=>{try{b.value=!0;const t=await w.list({page:n.value.page,pageSize:n.value.pageSize});V.value=t.secrets,n.value.total=t.total||t.secrets.length}catch{d.error("加载认证信息失败")}finally{b.value=!1}},C=async()=>{try{await w.create(r.value),d.success("认证信息添加成功"),g.value=!1,r.value={name:"",registry:"",username:"",password:""},u()}catch{d.error("添加认证失败")}},z=async t=>{try{await S.confirm("确定要删除这个认证信息吗？","确认删除",{type:"warning"}),await w.delete(t.id),d.success("认证信息已删除"),u()}catch(e){e!=="cancel"&&d.error("删除失败")}},x=async()=>{if(s.value.length===0){d.warning("请先选择要删除的认证信息");return}try{await S.confirm(`确定要删除选中的 ${s.value.length} 个认证信息吗？`,"确认删除",{type:"warning"});for(const t of s.value)await w.delete(t);d.success(`成功删除 ${s.value.length} 个认证信息`),s.value=[],u()}catch(t){t!=="cancel"&&d.error("批量删除失败")}},k=t=>{n.value.page=t,u()},A=t=>{n.value.pageSize=t,n.value.page=1,u()},U=t=>{t?s.value=V.value.map(e=>e.id):s.value=[]};return N(()=>{u()}),P(()=>{}),(t,e)=>{const v=i("el-button"),p=i("el-table-column"),D=i("el-table"),B=i("el-pagination"),_=i("el-input"),y=i("el-form-item"),$=i("el-form"),q=i("el-dialog"),E=I("loading");return j((J(),H("div",L,[f("div",T,[e[11]||(e[11]=f("h2",null,"仓库认证管理",-1)),f("div",F,[l(v,{type:"danger",disabled:s.value.length===0,onClick:x},{default:o(()=>[c(" 批量删除 ("+h(s.value.length)+") ",1)]),_:1},8,["disabled"]),l(v,{type:"primary",onClick:e[0]||(e[0]=a=>g.value=!0)},{default:o(()=>[...e[10]||(e[10]=[c(" 添加认证 ",-1)])]),_:1})])]),l(D,{data:V.value,onSelectionChange:e[1]||(e[1]=a=>s.value=a),style:{width:"100%"}},{default:o(()=>[l(p,{type:"selection",width:"55",onSelectAll:U}),l(p,{prop:"name",label:"名称",width:"200"}),l(p,{prop:"registry",label:"镜像仓库地址","min-width":"250"},{default:o(({row:a})=>[f("span",G,h(a.registry),1)]),_:1}),l(p,{prop:"username",label:"用户名",width:"150"}),l(p,{prop:"createdAt",label:"创建时间",width:"180"},{default:o(({row:a})=>[c(h(new Date(a.createdAt).toLocaleString()),1)]),_:1}),l(p,{label:"操作",width:"100",fixed:"right"},{default:o(({row:a})=>[l(v,{size:"small",type:"danger",onClick:W=>z(a)},{default:o(()=>[...e[12]||(e[12]=[c(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),f("div",O,[l(B,{"current-page":n.value.page,"onUpdate:currentPage":e[2]||(e[2]=a=>n.value.page=a),"page-size":n.value.pageSize,"onUpdate:pageSize":e[3]||(e[3]=a=>n.value.pageSize=a),"page-sizes":[10,20,50],total:n.value.total,layout:"sizes, prev, pager, next, total",background:!0,onSizeChange:A,onCurrentChange:k},null,8,["current-page","page-size","total"])]),l(q,{modelValue:g.value,"onUpdate:modelValue":e[9]||(e[9]=a=>g.value=a),title:"添加仓库认证",width:"500px"},{footer:o(()=>[l(v,{onClick:e[8]||(e[8]=a=>g.value=!1)},{default:o(()=>[...e[13]||(e[13]=[c("取消",-1)])]),_:1}),l(v,{type:"primary",onClick:C},{default:o(()=>[...e[14]||(e[14]=[c("添加",-1)])]),_:1})]),default:o(()=>[l($,{"label-width":"120px"},{default:o(()=>[l(y,{label:"认证名称",required:""},{default:o(()=>[l(_,{modelValue:r.value.name,"onUpdate:modelValue":e[4]||(e[4]=a=>r.value.name=a),placeholder:"例如：Harbor私有仓库"},null,8,["modelValue"])]),_:1}),l(y,{label:"仓库地址",required:""},{default:o(()=>[l(_,{modelValue:r.value.registry,"onUpdate:modelValue":e[5]||(e[5]=a=>r.value.registry=a),placeholder:"harbor.example.com"},null,8,["modelValue"])]),_:1}),l(y,{label:"用户名",required:""},{default:o(()=>[l(_,{modelValue:r.value.username,"onUpdate:modelValue":e[6]||(e[6]=a=>r.value.username=a),placeholder:"your-username"},null,8,["modelValue"])]),_:1}),l(y,{label:"密码",required:""},{default:o(()=>[l(_,{modelValue:r.value.password,"onUpdate:modelValue":e[7]||(e[7]=a=>r.value.password=a),type:"password",placeholder:"your-password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[E,b.value]])}}}),ee=K(Q,[["__scopeId","data-v-8bc8bee4"]]);export{ee as default};
