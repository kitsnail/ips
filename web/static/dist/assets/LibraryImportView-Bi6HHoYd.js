import{l as j}from"./api-6KZm3PBg.js";import{d as z,l as d,q as t,t as p,v as k,z as g,G as i,F as w,D as C,H as I,V as B,r as f,a as V,o as c,A as m}from"./element-plus-BmLo4b4r.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";const L={class:"max-w-[1200px] mx-auto py-6 px-4 sm:px-6 lg:px-8"},D={class:"flex justify-between items-center mb-8"},F={class:"flex gap-3"},H={class:"space-y-6"},M={class:"bg-white dark:bg-slate-800 rounded-xl p-6 sm:p-8 shadow-sm border border-slate-200 dark:border-slate-700"},S={class:"mt-4"},A={key:0,class:"mt-5 p-4 bg-red-50 dark:bg-red-900/20 border-l-4 border-red-500 rounded-r-lg"},P={class:"flex items-center gap-2 text-sm font-semibold text-red-700 dark:text-red-300 mb-3"},R={class:"flex flex-col gap-2"},q={class:"text-red-600 dark:text-red-400 font-mono font-bold min-w-[60px]"},G={class:"text-red-800 dark:text-red-200"},T={key:0,class:"bg-white dark:bg-slate-800 rounded-xl p-6 sm:p-8 shadow-sm border border-slate-200 dark:border-slate-700"},J={class:"flex justify-between items-center mb-5"},K={class:"px-3 py-1 bg-cyan-50 dark:bg-cyan-900/30 text-cyan-600 dark:text-cyan-400 rounded-full text-sm font-medium"},O={class:"flex flex-col gap-2 max-h-[400px] overflow-y-auto"},Q={class:"w-8 h-8 flex items-center justify-center bg-cyan-600 text-white rounded-full font-bold text-sm shrink-0"},W={class:"flex-1 font-medium text-slate-900 dark:text-slate-200 truncate"},X={class:"flex-[2] font-mono text-xs text-slate-500 dark:text-slate-400 truncate"},Y=z({__name:"LibraryImportView",setup(Z){const u=f(""),h=f(!1),x=f(0),b=f(0),s=f([]),l=f([]),y=a=>{const e=a.trim();if(!e)return"";const r=e.split("/");return r[r.length-1]||e},N=a=>{const e=a.trim();return e?/^[\w.\-\/:@]+$/.test(e)?{valid:!0,displayName:y(e),imageUrl:e}:{valid:!1,displayName:"",imageUrl:e}:{valid:!1,displayName:"",imageUrl:""}},_=()=>{const a=u.value.split(`
`),e=[],r=[];a.forEach((v,o)=>{const n=N(v);n.valid?r.push(n.imageUrl):e.push({line:o+1,error:n.imageUrl?`格式错误: ${n.imageUrl}`:"空行"})}),l.value=e,s.value=r},$=async()=>{if(s.value.length===0){m.warning("请输入要导入的镜像地址");return}if(l.value.length>0){m.warning(`发现 ${l.value.length} 个格式错误，请检查后重试`);return}try{h.value=!0,x.value=0,b.value=0;for(const a of s.value)try{await j.create({name:y(a),image:a}),x.value++}catch(e){b.value++,console.error(`Failed to import image: ${a}`,e)}x.value>0?m.success(`成功导入 ${x.value} 个镜像${b.value>0?`，失败 ${b.value} 个`:""}`):m.error("所有镜像导入失败"),u.value="",s.value=[],l.value=[],x.value=0,b.value=0}catch(a){m.error("导入失败，请稍后重试"),console.error("Import error:",a)}finally{h.value=!1}},U=()=>{u.value="",l.value=[],s.value=[]};return(a,e)=>{const r=V("el-button"),v=V("el-input");return c(),d("div",L,[t("div",D,[e[3]||(e[3]=t("h1",{class:"text-2xl font-bold text-slate-900 dark:text-white"},"批量导入镜像",-1)),t("div",F,[p(r,{onClick:U,disabled:!u.value&&l.value.length===0},{default:k(()=>[...e[1]||(e[1]=[g(" 清空 ",-1)])]),_:1},8,["disabled"]),p(r,{type:"primary",onClick:$,loading:h.value,disabled:s.value.length===0||l.value.length>0},{default:k(()=>[...e[2]||(e[2]=[g(" 导入 ",-1)])]),_:1},8,["loading","disabled"])])]),t("div",H,[t("div",M,[e[5]||(e[5]=t("div",{class:"flex justify-between items-center mb-5 pb-4 border-b border-slate-100 dark:border-slate-700"},[t("h3",{class:"text-lg font-semibold text-slate-900 dark:text-white"},"镜像列表"),t("div",{class:"text-sm text-slate-500 dark:text-slate-400"}," 每行输入一个镜像地址 ")],-1)),t("div",S,[p(v,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=o=>u.value=o),type:"textarea",rows:15,placeholder:`例如：
docker.io/library/nginx:latest
registry.cn-hangzhou.aliyuncs.com/library/redis:7
192.168.1.100:5000/myapp:v1.0.0`,onInput:_,class:"font-mono","input-style":{fontSize:"14px",lineHeight:"1.6"}},null,8,["modelValue"])]),l.value.length>0?(c(),d("div",A,[t("div",P,[e[4]||(e[4]=t("svg",{class:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M12 8v4m0 6h.01M12 21v-4m0-6H12m0-6h6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),g(" 格式错误 ("+i(l.value.length)+") ",1)]),t("div",R,[(c(!0),d(w,null,C(l.value,o=>(c(),d("div",{key:o.line,class:"flex items-start gap-3 text-[13px]"},[t("span",q,"行 "+i(o.line)+":",1),t("span",G,i(o.error),1)]))),128))])])):I("",!0)]),s.value.length>0&&l.value.length===0?(c(),d("div",T,[t("div",J,[e[6]||(e[6]=t("h3",{class:"text-lg font-semibold text-slate-900 dark:text-white"},"待导入镜像",-1)),t("div",K,i(s.value.length)+" 个 ",1)]),t("div",O,[(c(!0),d(w,null,C(s.value,(o,n)=>(c(),d("div",{key:n,class:"flex items-center gap-3 p-3 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-lg hover:bg-cyan-50 hover:border-cyan-500 dark:hover:bg-slate-800 dark:hover:border-cyan-500 transition-all duration-200 group"},[t("div",Q,i(n+1),1),t("div",W,i(y(o)),1),t("div",X,i(o),1),p(r,{type:"danger",size:"small",text:"",onClick:ee=>{s.value.splice(n,1),_()},class:"opacity-0 group-hover:opacity-100 transition-opacity"},{default:k(()=>[...e[7]||(e[7]=[g(" 移除 ",-1)])]),_:1},8,["onClick"])]))),128))])])):I("",!0),e[8]||(e[8]=B('<div class="bg-white dark:bg-slate-800 rounded-xl p-6 sm:p-8 shadow-sm border border-slate-200 dark:border-slate-700" data-v-592e4df0><h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-5" data-v-592e4df0>使用说明</h3><ul class="space-y-3 m-0 p-0 list-none" data-v-592e4df0><li class="relative pl-6 text-sm text-slate-600 dark:text-slate-400 leading-relaxed before:content-[&#39;•&#39;] before:absolute before:left-0 before:text-cyan-600 before:font-bold before:text-lg" data-v-592e4df0> 每行输入一个完整的镜像地址(包含仓库和tag) </li><li class="relative pl-6 text-sm text-slate-600 dark:text-slate-400 leading-relaxed before:content-[&#39;•&#39;] before:absolute before:left-0 before:text-cyan-600 before:font-bold before:text-lg" data-v-592e4df0> 格式示例: <code class="bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded text-slate-800 dark:text-slate-200 font-mono text-xs" data-v-592e4df0>docker.io/library/nginx:latest</code></li><li class="relative pl-6 text-sm text-slate-600 dark:text-slate-400 leading-relaxed before:content-[&#39;•&#39;] before:absolute before:left-0 before:text-cyan-600 before:font-bold before:text-lg" data-v-592e4df0> 支持私有仓库镜像和公共镜像 </li><li class="relative pl-6 text-sm text-slate-600 dark:text-slate-400 leading-relaxed before:content-[&#39;•&#39;] before:absolute before:left-0 before:text-cyan-600 before:font-bold before:text-lg" data-v-592e4df0> 导入时会自动从镜像地址提取显示名称 </li><li class="relative pl-6 text-sm text-slate-600 dark:text-slate-400 leading-relaxed before:content-[&#39;•&#39;] before:absolute before:left-0 before:text-cyan-600 before:font-bold before:text-lg" data-v-592e4df0> 重复的镜像名称会自动添加序号区分 </li></ul></div>',1))])])}}}),se=E(Y,[["__scopeId","data-v-592e4df0"]]);export{se as default};
