import{t as x,s as V}from"./index-Cnh6YuTo.js";import{d as S,A as N,H as B,I as E,a as T,b as s,D as l,f as a,w as o,j as r,r as d,E as M,i as c,J as R,o as A,C as j}from"./element-plus-DT46MLQ6.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"dashboard"},J={class:"dashboard-grid"},L={class:"stat-card primary"},P={class:"stat-value"},U={class:"stat-trend neutral"},q={class:"stat-card success"},z={class:"stat-value"},G={class:"stat-trend"},K={class:"stat-card info"},O={class:"stat-value"},Q={class:"stat-card warning"},W={class:"stat-value"},X={class:"stat-trend neutral"},Y={class:"card"},Z={class:"table-container"},$={key:0},tt=S({__name:"DashboardView",setup(st){const p=d(!1),b=d(0),k=d(0),I=d("0/0"),D=d(0),w=d(0),y=d([]);let h=null;const C=async()=>{try{p.value=!0;const[v,e]=await Promise.all([x.list({limit:1e3}),V.list({limit:100})]),i=v?.tasks||[],u=e?.tasks||[],g=i.filter(t=>t.status==="running").length,n=i.filter(t=>t.status==="pending").length;b.value=g+n;const m=new Date().toDateString(),_=i.filter(t=>new Date(t.createdAt).toDateString()===m),f=_.filter(t=>t.status==="completed").length;k.value=_.length>0?Math.round(f/_.length*100):100,D.value=u.length,w.value=u.filter(t=>t.enabled).length,y.value=i.slice(0,5)}catch(v){console.error("Dashboard loading error:",v),M.error("加载Dashboard失败")}finally{p.value=!1}};return N(()=>{C(),h=window.setInterval(()=>{C()},5e3)}),B(()=>{h&&clearInterval(h)}),(v,e)=>{const i=c("Clock"),u=c("el-icon"),g=c("TrendCharts"),n=c("el-table-column"),m=c("el-tag"),_=c("el-table"),f=R("loading");return E((A(),T("div",H,[s("div",J,[s("div",L,[e[1]||(e[1]=s("div",{class:"stat-label"},"运行中任务",-1)),s("div",P,l(b.value),1),s("div",U,[a(u,null,{default:o(()=>[a(i)]),_:1}),e[0]||(e[0]=r(" 实时更新 ",-1))])]),s("div",q,[e[3]||(e[3]=s("div",{class:"stat-label"},"今日成功率",-1)),s("div",z,l(k.value)+"%",1),s("div",G,[a(u,null,{default:o(()=>[a(g)]),_:1}),e[2]||(e[2]=r(" 良好 ",-1))])]),s("div",K,[e[4]||(e[4]=s("div",{class:"stat-label"},"节点覆盖",-1)),s("div",O,l(I.value),1),e[5]||(e[5]=s("div",{class:"stat-trend neutral"},"可用/总数",-1))]),s("div",Q,[e[6]||(e[6]=s("div",{class:"stat-label"},"定时任务",-1)),s("div",W,l(D.value),1),s("div",X,l(w.value)+" 个已启用 ",1)])]),s("div",Y,[e[7]||(e[7]=s("div",{class:"section-header"},[s("h3",{class:"section-title"},"最近任务")],-1)),s("div",Z,[a(_,{data:y.value,style:{width:"100%"}},{default:o(()=>[a(n,{prop:"taskId",label:"任务ID",width:"180"}),a(n,{prop:"status",label:"状态",width:"100"},{default:o(({row:t})=>[a(m,{type:t.status==="completed"?"success":t.status==="failed"?"danger":"info"},{default:o(()=>[r(l(t.status),1)]),_:2},1032,["type"])]),_:1}),a(n,{prop:"images",label:"镜像"},{default:o(({row:t})=>[r(l(t.images[0])+" ",1),t.images.length>1?(A(),T("span",$,"+"+l(t.images.length-1),1)):j("",!0)]),_:1}),a(n,{prop:"progress.percentage",label:"进度",width:"120"},{default:o(({row:t})=>[r(l(t.progress?.percentage?.toFixed(1)||0)+"% ",1)]),_:1}),a(n,{prop:"createdAt",label:"创建时间",width:"180"},{default:o(({row:t})=>[r(l(new Date(t.createdAt).toLocaleString()),1)]),_:1})]),_:1},8,["data"])])])])),[[f,p.value]])}}}),ot=F(tt,[["__scopeId","data-v-31488da4"]]);export{ot as default};
