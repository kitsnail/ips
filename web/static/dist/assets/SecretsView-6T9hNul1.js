import{b as _}from"./index-HqSX5ej0.js";import{d as $,A as q,H as E,I as M,a as N,b as y,f as l,w as a,r as f,E as n,i as d,J as z,o as H,j as u,D as h,K as x}from"./element-plus-DT46MLQ6.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"secrets"},K={class:"header"},L={class:"actions"},T={style:{"font-family":"monospace",color:"#0891b2"}},F=$({__name:"SecretsView",setup(G){const g=f(!1),b=f([]),m=f(!1),r=f([]);let V=null;const s=f({name:"",registry:"",username:"",password:""}),p=async()=>{try{g.value=!0;const o=await _.list({pageSize:100});b.value=o.secrets}catch{n.error("加载认证信息失败")}finally{g.value=!1}},C=async()=>{try{await _.create(s.value),n.success("认证信息添加成功"),m.value=!1,s.value={name:"",registry:"",username:"",password:""},p()}catch{n.error("添加认证失败")}},S=async o=>{try{await x.confirm("确定要删除这个认证信息吗？","确认删除",{type:"warning"}),await _.delete(o.id),n.success("认证信息已删除"),p()}catch(e){e!=="cancel"&&n.error("删除失败")}},k=async()=>{if(r.value.length===0){n.warning("请先选择要删除的认证信息");return}try{await x.confirm(`确定要删除选中的 ${r.value.length} 个认证信息吗？`,"确认删除",{type:"warning"});for(const o of r.value)await _.delete(o);n.success(`成功删除 ${r.value.length} 个认证信息`),r.value=[],p()}catch(o){o!=="cancel"&&n.error("批量删除失败")}},A=o=>{o?r.value=b.value.map(e=>e.id):r.value=[]};return q(()=>{p(),V=window.setInterval(()=>{p()},5e3)}),E(()=>{V&&clearInterval(V)}),(o,e)=>{const c=d("el-button"),i=d("el-table-column"),D=d("el-table"),v=d("el-input"),w=d("el-form-item"),U=d("el-form"),B=d("el-dialog"),I=z("loading");return M((H(),N("div",J,[y("div",K,[e[9]||(e[9]=y("h2",null,"仓库认证管理",-1)),y("div",L,[l(c,{type:"danger",disabled:r.value.length===0,onClick:k},{default:a(()=>[u(" 批量删除 ("+h(r.value.length)+") ",1)]),_:1},8,["disabled"]),l(c,{type:"primary",onClick:e[0]||(e[0]=t=>m.value=!0)},{default:a(()=>[...e[8]||(e[8]=[u(" 添加认证 ",-1)])]),_:1})])]),l(D,{data:b.value,onSelectionChange:e[1]||(e[1]=t=>r.value=t),style:{width:"100%"}},{default:a(()=>[l(i,{type:"selection",width:"55",onSelectAll:A}),l(i,{prop:"name",label:"名称",width:"200"}),l(i,{prop:"registry",label:"镜像仓库地址","min-width":"250"},{default:a(({row:t})=>[y("span",T,h(t.registry),1)]),_:1}),l(i,{prop:"username",label:"用户名",width:"150"}),l(i,{prop:"createdAt",label:"创建时间",width:"180"},{default:a(({row:t})=>[u(h(new Date(t.createdAt).toLocaleString()),1)]),_:1}),l(i,{label:"操作",width:"100",fixed:"right"},{default:a(({row:t})=>[l(c,{size:"small",type:"danger",onClick:O=>S(t)},{default:a(()=>[...e[10]||(e[10]=[u(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),l(B,{modelValue:m.value,"onUpdate:modelValue":e[7]||(e[7]=t=>m.value=t),title:"添加仓库认证",width:"500px"},{footer:a(()=>[l(c,{onClick:e[6]||(e[6]=t=>m.value=!1)},{default:a(()=>[...e[11]||(e[11]=[u("取消",-1)])]),_:1}),l(c,{type:"primary",onClick:C},{default:a(()=>[...e[12]||(e[12]=[u("添加",-1)])]),_:1})]),default:a(()=>[l(U,{"label-width":"120px"},{default:a(()=>[l(w,{label:"认证名称",required:""},{default:a(()=>[l(v,{modelValue:s.value.name,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.name=t),placeholder:"例如：Harbor私有仓库"},null,8,["modelValue"])]),_:1}),l(w,{label:"仓库地址",required:""},{default:a(()=>[l(v,{modelValue:s.value.registry,"onUpdate:modelValue":e[3]||(e[3]=t=>s.value.registry=t),placeholder:"harbor.example.com"},null,8,["modelValue"])]),_:1}),l(w,{label:"用户名",required:""},{default:a(()=>[l(v,{modelValue:s.value.username,"onUpdate:modelValue":e[4]||(e[4]=t=>s.value.username=t),placeholder:"your-username"},null,8,["modelValue"])]),_:1}),l(w,{label:"密码",required:""},{default:a(()=>[l(v,{modelValue:s.value.password,"onUpdate:modelValue":e[5]||(e[5]=t=>s.value.password=t),type:"password",placeholder:"your-password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[I,g.value]])}}}),W=j(F,[["__scopeId","data-v-8478ccd3"]]);export{W as default};
