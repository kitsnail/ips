import{c as w}from"./index-Cnh6YuTo.js";import{d as I,A as N,I as z,a as k,b as p,f as l,w as a,r as _,E as r,i as o,J as S,o as y,j as d,D as x,c as j,K as F}from"./element-plus-DT46MLQ6.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"admin-view"},L={class:"header"},T={key:1,style:{color:"#999","font-size":"13px"}},G=I({__name:"AdminView",setup(H){const c=_(!1),b=_([]),i=_(!1),n=_({username:"",password:"",role:"viewer"}),f=async()=>{try{c.value=!0,b.value=await w.list()}catch{r.error("加载用户列表失败")}finally{c.value=!1}},D=async()=>{try{if(!n.value.username||!n.value.password){r.warning("请填写用户名和密码");return}await w.create(n.value),r.success("用户创建成功"),i.value=!1,V(),f()}catch{r.error("创建用户失败")}},A=async s=>{if(s.username==="admin"){r.warning("不能删除 admin 用户");return}try{await F.confirm(`确定要删除用户 ${s.username} 吗？`,"确认删除",{type:"warning"}),await w.delete(s.id),r.success("用户已删除"),f()}catch(e){e!=="cancel"&&r.error("删除用户失败")}},V=()=>{n.value={username:"",password:"",role:"viewer"}};return N(()=>{f()}),(s,e)=>{const m=o("el-button"),u=o("el-table-column"),B=o("el-tag"),U=o("el-table"),h=o("el-card"),g=o("el-input"),v=o("el-form-item"),C=o("el-option"),E=o("el-select"),M=o("el-form"),$=o("el-dialog"),q=S("loading");return z((y(),k("div",K,[p("div",L,[e[7]||(e[7]=p("h2",null,"系统管理",-1)),l(m,{type:"primary",onClick:e[0]||(e[0]=t=>i.value=!0)},{default:a(()=>[...e[6]||(e[6]=[d("新建用户",-1)])]),_:1})]),l(h,null,{header:a(()=>[...e[8]||(e[8]=[p("div",{class:"card-header"},[p("span",null,"用户列表")],-1)])]),default:a(()=>[l(U,{data:b.value,style:{width:"100%"}},{default:a(()=>[l(u,{prop:"id",label:"ID",width:"80"}),l(u,{prop:"username",label:"用户名",width:"150"}),l(u,{prop:"role",label:"角色",width:"120"},{default:a(({row:t})=>[l(B,{type:t.role==="admin"?"danger":"primary"},{default:a(()=>[d(x(t.role==="admin"?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),l(u,{prop:"createdAt",label:"创建时间",width:"180"},{default:a(({row:t})=>[d(x(new Date(t.createdAt).toLocaleString()),1)]),_:1}),l(u,{label:"操作",width:"120"},{default:a(({row:t})=>[t.username!=="admin"?(y(),j(m,{key:0,size:"small",type:"danger",onClick:O=>A(t)},{default:a(()=>[...e[9]||(e[9]=[d(" 删除 ",-1)])]),_:1},8,["onClick"])):(y(),k("span",T,"不可删除"))]),_:1})]),_:1},8,["data"])]),_:1}),l($,{modelValue:i.value,"onUpdate:modelValue":e[5]||(e[5]=t=>i.value=t),title:"创建用户",width:"500px",onClose:V},{footer:a(()=>[l(m,{onClick:e[4]||(e[4]=t=>i.value=!1)},{default:a(()=>[...e[10]||(e[10]=[d("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:D},{default:a(()=>[...e[11]||(e[11]=[d("创建",-1)])]),_:1})]),default:a(()=>[l(M,{"label-width":"100px"},{default:a(()=>[l(v,{label:"用户名",required:""},{default:a(()=>[l(g,{modelValue:n.value.username,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.username=t),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(v,{label:"密码",required:""},{default:a(()=>[l(g,{modelValue:n.value.password,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.password=t),type:"password","show-password":"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),l(v,{label:"角色",required:""},{default:a(()=>[l(E,{modelValue:n.value.role,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.role=t),style:{width:"100%"}},{default:a(()=>[l(C,{label:"普通用户",value:"viewer"}),l(C,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[q,c.value]])}}}),W=J(G,[["__scopeId","data-v-88591e40"]]);export{W as default};
