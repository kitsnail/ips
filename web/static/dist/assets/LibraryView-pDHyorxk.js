import{l as y}from"./index-BE6ap8Ug.js";import{d as E,A as M,H as N,I as j,a as q,b as c,f as l,w as n,r as g,E as i,i as d,J as H,o as J,j as m,D as w,K as x}from"./element-plus-DT46MLQ6.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const T={class:"library"},F={class:"header"},G={class:"actions"},O={style:{"font-family":"monospace",color:"#0891b2"}},Q={style:{display:"flex","justify-content":"center","margin-top":"20px"}},R=E({__name:"LibraryView",setup(W){const _=g(!1),b=g([]),o=g({page:1,pageSize:10,total:0}),f=g(!1),r=g([]),v=g(""),p=async()=>{try{_.value=!0;const t=(o.value.page-1)*o.value.pageSize,e=await y.list({limit:o.value.pageSize,offset:t});b.value=e.images,o.value.total=e.total||e.images.length}catch{i.error("加载镜像库失败")}finally{_.value=!1}},z=t=>{const e=t.trim();if(!e)return"";const s=e.split("/");return s[s.length-1]||""},S=async()=>{const t=v.value.split(`
`).map(e=>e.trim()).filter(e=>e.length>0);if(t.length===0){i.warning("请输入至少一个镜像地址");return}try{let e=0,s=0;for(const u of t)try{await y.create({name:z(u),image:u}),e++}catch{s++}e>0?(i.success(`成功添加 ${e} 个镜像${s>0?`，失败 ${s} 个`:""}`),f.value=!1,v.value="",p()):i.error("所有镜像添加失败")}catch{i.error("添加镜像失败")}},V=async t=>{try{await x.confirm("确定要删除这个镜像吗？","确认删除",{type:"warning"}),await y.delete(t.id),i.success("镜像已删除"),p()}catch(e){e!=="cancel"&&i.error("删除失败")}},k=async()=>{if(r.value.length===0){i.warning("请先选择要删除的镜像");return}try{await x.confirm(`确定要删除选中的 ${r.value.length} 个镜像吗？`,"确认删除",{type:"warning"});for(const t of r.value)await y.delete(t);i.success(`成功删除 ${r.value.length} 个镜像`),r.value=[],p()}catch(t){t!=="cancel"&&i.error("批量删除失败")}},A=t=>{o.value.page=t,p()},D=t=>{o.value.pageSize=t,o.value.page=1,p()},$=t=>{t?r.value=b.value.map(e=>e.id):r.value=[]};return M(()=>{p()}),N(()=>{}),(t,e)=>{const s=d("el-button"),u=d("el-table-column"),h=d("el-table"),I=d("el-pagination"),B=d("el-input"),C=d("el-form-item"),L=d("el-form"),P=d("el-dialog"),U=H("loading");return j((J(),q("div",T,[c("div",F,[e[8]||(e[8]=c("h2",null,"镜像库管理",-1)),c("div",G,[l(s,{type:"danger",disabled:r.value.length===0,onClick:k},{default:n(()=>[m(" 批量删除 ("+w(r.value.length)+") ",1)]),_:1},8,["disabled"]),l(s,{type:"primary",onClick:e[0]||(e[0]=a=>f.value=!0)},{default:n(()=>[...e[7]||(e[7]=[m(" 添加镜像 ",-1)])]),_:1})])]),l(h,{data:b.value,onSelectionChange:e[1]||(e[1]=a=>r.value=a),style:{width:"100%"}},{default:n(()=>[l(u,{type:"selection",width:"55",onSelectAll:$}),l(u,{prop:"name",label:"显示名称",width:"200"}),l(u,{prop:"image",label:"镜像地址","min-width":"300"},{default:n(({row:a})=>[c("span",O,w(a.image),1)]),_:1}),l(u,{prop:"createdAt",label:"添加时间",width:"180"},{default:n(({row:a})=>[m(w(new Date(a.createdAt).toLocaleString()),1)]),_:1}),l(u,{label:"操作",width:"100",fixed:"right"},{default:n(({row:a})=>[l(s,{size:"small",type:"danger",onClick:X=>V(a)},{default:n(()=>[...e[9]||(e[9]=[m(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),c("div",Q,[l(I,{"current-page":o.value.page,"onUpdate:currentPage":e[2]||(e[2]=a=>o.value.page=a),"page-size":o.value.pageSize,"onUpdate:pageSize":e[3]||(e[3]=a=>o.value.pageSize=a),"page-sizes":[10,20,50],total:o.value.total,layout:"sizes, prev, pager, next, total",background:!0,onSizeChange:D,onCurrentChange:A},null,8,["current-page","page-size","total"])]),l(P,{modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=a=>f.value=a),title:"添加镜像",width:"700px"},{footer:n(()=>[l(s,{onClick:e[5]||(e[5]=a=>f.value=!1)},{default:n(()=>[...e[11]||(e[11]=[m("取消",-1)])]),_:1}),l(s,{type:"primary",onClick:S},{default:n(()=>[...e[12]||(e[12]=[m("添加",-1)])]),_:1})]),default:n(()=>[l(L,{"label-width":"100px"},{default:n(()=>[l(C,{label:"镜像地址",required:""},{default:n(()=>[l(B,{modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=a=>v.value=a),type:"textarea",rows:8,placeholder:`每行输入一个镜像地址，例如：
192.168.3.81/ips/spec-b1:v0
docker.io/library/nginx:latest
registry.cn-hangzhou.aliyuncs.com/library/redis:7`},null,8,["modelValue"])]),_:1}),l(C,{label:"提示"},{default:n(()=>[...e[10]||(e[10]=[c("span",{style:{color:"#909399","font-size":"12px"}}," • 每行一个镜像地址 • 显示名称将自动从镜像地址中提取（例如：spec-b1:v0） • 支持批量添加多个镜像 ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[U,_.value]])}}}),te=K(R,[["__scopeId","data-v-732e94ac"]]);export{te as default};
