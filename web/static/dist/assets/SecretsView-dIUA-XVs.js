import{b as w}from"./api-6KZm3PBg.js";import{d as E,Q as N,R as P,B as j,l as G,q as m,t as l,v as o,r as c,A as d,a as i,S as H,o as I,z as g,G as V,U as S}from"./element-plus-K37pJI3g.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"secrets"},R={class:"header"},T={class:"actions"},F={style:{"font-family":"monospace",color:"#0891b2"}},J={style:{display:"flex","justify-content":"center","margin-top":"20px"}},K=E({__name:"SecretsView",setup(O){const b=c(!1),h=c([]),n=c({page:1,pageSize:10,total:0}),v=c(!1),s=c([]),r=c({name:"",registry:"",username:"",password:""}),u=async()=>{try{b.value=!0;const t=await w.list({page:n.value.page,pageSize:n.value.pageSize});h.value=t.secrets,n.value.total=t.total||t.secrets.length}catch{d.error("加载认证信息失败")}finally{b.value=!1}},z=async()=>{try{await w.create(r.value),d.success("认证信息添加成功"),v.value=!1,r.value={name:"",registry:"",username:"",password:""},u()}catch{d.error("添加认证失败")}},C=async t=>{try{await S.confirm("确定要删除这个认证信息吗？","确认删除",{type:"warning"}),await w.delete(t.id),d.success("认证信息已删除"),u()}catch(e){e!=="cancel"&&d.error("删除失败")}},x=async()=>{if(s.value.length===0){d.warning("请先选择要删除的认证信息");return}try{await S.confirm(`确定要删除选中的 ${s.value.length} 个认证信息吗？`,"确认删除",{type:"warning"});for(const t of s.value)await w.delete(t);d.success(`成功删除 ${s.value.length} 个认证信息`),s.value=[],u()}catch(t){t!=="cancel"&&d.error("批量删除失败")}},U=t=>{n.value.page=t,u()},k=t=>{n.value.pageSize=t,n.value.page=1,u()},A=t=>{t?s.value=h.value.map(e=>e.id):s.value=[]};return N(()=>{u()}),P(()=>{}),(t,e)=>{const f=i("el-button"),p=i("el-table-column"),B=i("el-table"),D=i("el-pagination"),_=i("el-input"),y=i("el-form-item"),q=i("el-form"),M=i("el-dialog"),$=H("loading");return j((I(),G("div",Q,[m("div",R,[e[9]||(e[9]=m("h2",null,"仓库认证管理",-1)),m("div",T,[l(f,{type:"danger",disabled:s.value.length===0,onClick:x},{default:o(()=>[g(" 批量删除 ("+V(s.value.length)+") ",1)]),_:1},8,["disabled"])])]),l(B,{data:h.value,onSelectionChange:e[0]||(e[0]=a=>s.value=a),style:{width:"100%"}},{default:o(()=>[l(p,{type:"selection",width:"55",onSelectAll:A}),l(p,{prop:"name",label:"名称",width:"200"}),l(p,{prop:"registry",label:"镜像仓库地址","min-width":"250"},{default:o(({row:a})=>[m("span",F,V(a.registry),1)]),_:1}),l(p,{prop:"username",label:"用户名",width:"150"}),l(p,{prop:"createdAt",label:"创建时间",width:"180"},{default:o(({row:a})=>[g(V(new Date(a.createdAt).toLocaleString()),1)]),_:1}),l(p,{label:"操作",width:"100",fixed:"right"},{default:o(({row:a})=>[l(f,{size:"small",type:"danger",onClick:W=>C(a)},{default:o(()=>[...e[10]||(e[10]=[g(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),m("div",J,[l(D,{"current-page":n.value.page,"onUpdate:currentPage":e[1]||(e[1]=a=>n.value.page=a),"page-size":n.value.pageSize,"onUpdate:pageSize":e[2]||(e[2]=a=>n.value.pageSize=a),"page-sizes":[10,20,50],total:n.value.total,layout:"sizes, prev, pager, next, total",background:!0,onSizeChange:k,onCurrentChange:U},null,8,["current-page","page-size","total"])]),l(M,{modelValue:v.value,"onUpdate:modelValue":e[8]||(e[8]=a=>v.value=a),title:"添加仓库认证",width:"500px"},{footer:o(()=>[l(f,{onClick:e[7]||(e[7]=a=>v.value=!1)},{default:o(()=>[...e[11]||(e[11]=[g("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:z},{default:o(()=>[...e[12]||(e[12]=[g("添加",-1)])]),_:1})]),default:o(()=>[l(q,{"label-width":"120px"},{default:o(()=>[l(y,{label:"认证名称",required:""},{default:o(()=>[l(_,{modelValue:r.value.name,"onUpdate:modelValue":e[3]||(e[3]=a=>r.value.name=a),placeholder:"例如：Harbor私有仓库"},null,8,["modelValue"])]),_:1}),l(y,{label:"仓库地址",required:""},{default:o(()=>[l(_,{modelValue:r.value.registry,"onUpdate:modelValue":e[4]||(e[4]=a=>r.value.registry=a),placeholder:"harbor.example.com"},null,8,["modelValue"])]),_:1}),l(y,{label:"用户名",required:""},{default:o(()=>[l(_,{modelValue:r.value.username,"onUpdate:modelValue":e[5]||(e[5]=a=>r.value.username=a),placeholder:"your-username"},null,8,["modelValue"])]),_:1}),l(y,{label:"密码",required:""},{default:o(()=>[l(_,{modelValue:r.value.password,"onUpdate:modelValue":e[6]||(e[6]=a=>r.value.password=a),type:"password",placeholder:"your-password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[$,b.value]])}}}),ee=L(K,[["__scopeId","data-v-0528821b"]]);export{ee as default};
