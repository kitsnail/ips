import{s as p}from"./index-D5L2XjAQ.js";import{d as A,G as R,H as j,I as F,g as S,j as k,k as l,l as a,r as _,E as r,q as s,J as G,t as h,v as i,C as v,B as H,K as J}from"./element-plus-D4iBZxCD.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const L={class:"scheduled-tasks"},O={class:"header"},Q={key:0},W=A({__name:"ScheduledTasksView",setup(X){const b=_(!1),V=_([]),c=_(!1);let g=null;const o=_({name:"",description:"",cronExpr:"",enabled:!0,taskConfig:{images:[],batchSize:10,priority:5,maxRetries:0,retryStrategy:"linear",retryDelay:30,webhookUrl:""},overlapPolicy:"skip",timeoutSeconds:0}),f=async()=>{try{b.value=!0;const n=await p.list({limit:50,offset:0});V.value=n.tasks}catch{r.error("加载定时任务失败")}finally{b.value=!1}},U=async()=>{try{await p.create(o.value),r.success("定时任务创建成功"),c.value=!1,f()}catch{r.error("创建定时任务失败")}},E=async n=>{try{n.enabled?(await p.disable(n.id),r.success("定时任务已禁用")):(await p.enable(n.id),r.success("定时任务已启用")),f()}catch{r.error("操作失败")}},z=async n=>{try{await p.trigger(n.id),r.success("定时任务已触发")}catch{r.error("触发失败")}},T=async n=>{try{await J.confirm("确定要删除这个定时任务吗？","确认删除",{type:"warning"}),await p.delete(n.id),r.success("定时任务已删除"),f()}catch(e){e!=="cancel"&&r.error("删除失败")}},D=()=>{o.value={name:"",description:"",cronExpr:"",enabled:!0,taskConfig:{images:[],batchSize:10,priority:5,maxRetries:0,retryStrategy:"linear",retryDelay:30,webhookUrl:""},overlapPolicy:"skip",timeoutSeconds:0}};return R(()=>{f(),g=window.setInterval(()=>{f()},5e3)}),j(()=>{g&&clearInterval(g)}),(n,e)=>{const u=s("el-button"),m=s("el-table-column"),B=s("el-tag"),I=s("el-table"),y=s("el-input"),d=s("el-form-item"),C=s("el-input-number"),$=s("el-switch"),w=s("el-option"),q=s("el-select"),M=s("el-form"),N=s("el-dialog"),P=G("loading");return F((h(),S("div",L,[k("div",O,[e[11]||(e[11]=k("h2",null,"定时任务管理",-1)),l(u,{type:"primary",onClick:e[0]||(e[0]=t=>c.value=!0)},{default:a(()=>[...e[10]||(e[10]=[i("新建定时任务",-1)])]),_:1})]),l(I,{data:V.value,style:{width:"100%"}},{default:a(()=>[l(m,{prop:"name",label:"任务名称",width:"200"}),l(m,{prop:"cronExpr",label:"Cron表达式",width:"150"}),l(m,{prop:"taskConfig.images",label:"镜像","min-width":"200"},{default:a(({row:t})=>[i(v(t.taskConfig.images[0])+" ",1),t.taskConfig.images.length>1?(h(),S("span",Q,"+"+v(t.taskConfig.images.length-1),1)):H("",!0)]),_:1}),l(m,{prop:"enabled",label:"状态",width:"100"},{default:a(({row:t})=>[l(B,{type:t.enabled?"success":"info"},{default:a(()=>[i(v(t.enabled?"已启用":"已禁用"),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"createdAt",label:"创建时间",width:"180"},{default:a(({row:t})=>[i(v(new Date(t.createdAt).toLocaleString()),1)]),_:1}),l(m,{label:"操作",width:"280",fixed:"right"},{default:a(({row:t})=>[l(u,{size:"small",onClick:x=>E(t)},{default:a(()=>[i(v(t.enabled?"禁用":"启用"),1)]),_:2},1032,["onClick"]),l(u,{size:"small",type:"primary",onClick:x=>z(t)},{default:a(()=>[...e[12]||(e[12]=[i(" 触发 ",-1)])]),_:1},8,["onClick"]),l(u,{size:"small",type:"danger",onClick:x=>T(t)},{default:a(()=>[...e[13]||(e[13]=[i(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),l(N,{modelValue:c.value,"onUpdate:modelValue":e[9]||(e[9]=t=>c.value=t),title:"创建定时任务",width:"700px",onClose:D},{footer:a(()=>[l(u,{onClick:e[8]||(e[8]=t=>c.value=!1)},{default:a(()=>[...e[15]||(e[15]=[i("取消",-1)])]),_:1}),l(u,{type:"primary",onClick:U},{default:a(()=>[...e[16]||(e[16]=[i("创建",-1)])]),_:1})]),default:a(()=>[l(M,{"label-width":"120px"},{default:a(()=>[l(d,{label:"任务名称",required:""},{default:a(()=>[l(y,{modelValue:o.value.name,"onUpdate:modelValue":e[1]||(e[1]=t=>o.value.name=t),placeholder:"例如：每日镜像预热"},null,8,["modelValue"])]),_:1}),l(d,{label:"Cron表达式",required:""},{default:a(()=>[l(y,{modelValue:o.value.cronExpr,"onUpdate:modelValue":e[2]||(e[2]=t=>o.value.cronExpr=t),placeholder:"0 2 * * *"},null,8,["modelValue"]),e[14]||(e[14]=k("div",{style:{"font-size":"12px",color:"#64748b","margin-top":"4px"}}," 示例：每天凌晨2点（0 2 * * *）、每小时（0 * * * *） ",-1))]),_:1}),l(d,{label:"镜像列表",required:""},{default:a(()=>[l(y,{modelValue:o.value.taskConfig.images,"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.taskConfig.images=t),type:"textarea",rows:4,placeholder:"每行一个镜像地址"},null,8,["modelValue"])]),_:1}),l(d,{label:"批次大小"},{default:a(()=>[l(C,{modelValue:o.value.taskConfig.batchSize,"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.taskConfig.batchSize=t),min:1,max:100},null,8,["modelValue"])]),_:1}),l(d,{label:"启用任务"},{default:a(()=>[l($,{modelValue:o.value.enabled,"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.enabled=t)},null,8,["modelValue"])]),_:1}),l(d,{label:"重叠策略"},{default:a(()=>[l(q,{modelValue:o.value.overlapPolicy,"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.overlapPolicy=t)},{default:a(()=>[l(w,{label:"跳过（不执行）",value:"skip"}),l(w,{label:"允许（排队）",value:"allow"})]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"超时时间（秒）"},{default:a(()=>[l(C,{modelValue:o.value.timeoutSeconds,"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.timeoutSeconds=t),min:0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[P,b.value]])}}}),le=K(W,[["__scopeId","data-v-2217ff7b"]]);export{le as default};
