import{t as S,s as x}from"./index-BzXyuT2b.js";import{d as B,G as N,H as $,I as E,g as I,j as s,C as n,k as a,l as o,v as d,r,E as M,q as c,J as R,t as A,B as z}from"./element-plus-BS5ldEX1.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";const q={class:"dashboard"},F={class:"dashboard-grid"},G={class:"stat-card primary"},H={class:"stat-value"},J={class:"stat-trend neutral"},L={class:"stat-card success"},P={class:"stat-value"},U={class:"stat-trend"},K={class:"stat-card info"},O={class:"stat-value"},Q={class:"stat-card warning"},W={class:"stat-value"},X={class:"stat-trend neutral"},Y={class:"card"},Z={class:"section-header"},tt={class:"section-actions"},st={class:"table-container"},et={key:0},at=B({__name:"DashboardView",setup(lt){const g=r(!1),k=r(0),y=r(0),V=r("0/0"),D=r(0),w=r(0),C=r([]);let f=null;const T=async()=>{try{g.value=!0;const[_,t]=await Promise.all([S.list({limit:1e3}),x.list({limit:100})]),u=_.tasks,v=t.tasks,h=u.filter(l=>l.status==="running").length,m=u.filter(l=>l.status==="pending").length;k.value=h+m;const i=new Date().toDateString(),p=u.filter(l=>new Date(l.createdAt).toDateString()===i),b=p.filter(l=>l.status==="completed").length;y.value=p.length>0?Math.round(b/p.length*100):100,D.value=v.length,w.value=v.filter(l=>l.enabled).length,C.value=u.slice(0,5)}catch{M.error("加载Dashboard失败")}finally{g.value=!1}};return N(()=>{T(),f=window.setInterval(()=>{T()},5e3)}),$(()=>{f&&clearInterval(f)}),(_,t)=>{const u=c("Clock"),v=c("el-icon"),h=c("TrendCharts"),m=c("el-button"),i=c("el-table-column"),p=c("el-tag"),b=c("el-table"),l=R("loading");return E((A(),I("div",q,[s("div",F,[s("div",G,[t[3]||(t[3]=s("div",{class:"stat-label"},"运行中任务",-1)),s("div",H,n(k.value),1),s("div",J,[a(v,null,{default:o(()=>[a(u)]),_:1}),t[2]||(t[2]=d(" 实时更新 ",-1))])]),s("div",L,[t[5]||(t[5]=s("div",{class:"stat-label"},"今日成功率",-1)),s("div",P,n(y.value)+"%",1),s("div",U,[a(v,null,{default:o(()=>[a(h)]),_:1}),t[4]||(t[4]=d(" 良好 ",-1))])]),s("div",K,[t[6]||(t[6]=s("div",{class:"stat-label"},"节点覆盖",-1)),s("div",O,n(V.value),1),t[7]||(t[7]=s("div",{class:"stat-trend neutral"},"可用/总数",-1))]),s("div",Q,[t[8]||(t[8]=s("div",{class:"stat-label"},"定时任务",-1)),s("div",W,n(D.value),1),s("div",X,n(w.value)+" 个已启用 ",1)])]),s("div",Y,[s("div",Z,[t[11]||(t[11]=s("h3",{class:"section-title"},"最近任务",-1)),s("div",tt,[a(m,{type:"primary",size:"small",onClick:t[0]||(t[0]=e=>_.$router.push("/tasks"))},{default:o(()=>[...t[9]||(t[9]=[d(" 新建任务 ",-1)])]),_:1}),a(m,{size:"small",onClick:t[1]||(t[1]=e=>_.$router.push("/tasks"))},{default:o(()=>[...t[10]||(t[10]=[d(" 查看全部 ",-1)])]),_:1})])]),s("div",st,[a(b,{data:C.value,style:{width:"100%"}},{default:o(()=>[a(i,{prop:"taskId",label:"任务ID",width:"180"}),a(i,{prop:"status",label:"状态",width:"100"},{default:o(({row:e})=>[a(p,{type:e.status==="completed"?"success":e.status==="failed"?"danger":"info"},{default:o(()=>[d(n(e.status),1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"images",label:"镜像"},{default:o(({row:e})=>[d(n(e.images[0])+" ",1),e.images.length>1?(A(),I("span",et,"+"+n(e.images.length-1),1)):z("",!0)]),_:1}),a(i,{prop:"progress.percentage",label:"进度",width:"120"},{default:o(({row:e})=>[d(n(e.progress?.percentage?.toFixed(1)||0)+"% ",1)]),_:1}),a(i,{prop:"createdAt",label:"创建时间",width:"180"},{default:o(({row:e})=>[d(n(new Date(e.createdAt).toLocaleString()),1)]),_:1})]),_:1},8,["data"])])])])),[[l,g.value]])}}}),it=j(at,[["__scopeId","data-v-67789670"]]);export{it as default};
