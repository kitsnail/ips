import{t as x,s as S}from"./api-6KZm3PBg.js";import{d as V,Q as B,R as N,B as R,l as w,q as s,G as o,t as a,v as l,z as r,r as d,A as I,a as c,S as M,o as C,H as E}from"./element-plus-K37pJI3g.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const z={class:"dashboard"},F={class:"dashboard-grid"},G={class:"stat-card primary"},H={class:"stat-value"},L={class:"stat-trend neutral"},P={class:"stat-card success"},Q={class:"stat-value"},U={class:"stat-trend"},j={class:"stat-card info"},J={class:"stat-value"},K={class:"stat-card warning"},O={class:"stat-value"},W={class:"stat-trend neutral"},X={class:"card"},Y={class:"table-container"},Z={key:0},$=V({__name:"DashboardView",setup(tt){const p=d(!1),f=d(0),b=d(0),T=d("0/0"),k=d(0),D=d(0),y=d([]),A=async()=>{try{p.value=!0;const[v,e]=await Promise.all([x.list({limit:1e3}),S.list({limit:100})]),i=v?.tasks||[],u=e?.tasks||[],g=i.filter(t=>t.status==="running").length,n=i.filter(t=>t.status==="pending").length;f.value=g+n;const h=new Date().toDateString(),_=i.filter(t=>new Date(t.createdAt).toDateString()===h),m=_.filter(t=>t.status==="completed").length;b.value=_.length>0?Math.round(m/_.length*100):100,k.value=u.length,D.value=u.filter(t=>t.enabled).length,y.value=i.slice(0,5)}catch(v){console.error("Dashboard loading error:",v),I.error("加载Dashboard失败")}finally{p.value=!1}};return B(()=>{A()}),N(()=>{}),(v,e)=>{const i=c("Clock"),u=c("el-icon"),g=c("TrendCharts"),n=c("el-table-column"),h=c("el-tag"),_=c("el-table"),m=M("loading");return R((C(),w("div",z,[s("div",F,[s("div",G,[e[1]||(e[1]=s("div",{class:"stat-label"},"运行中任务",-1)),s("div",H,o(f.value),1),s("div",L,[a(u,null,{default:l(()=>[a(i)]),_:1}),e[0]||(e[0]=r(" 实时更新 ",-1))])]),s("div",P,[e[3]||(e[3]=s("div",{class:"stat-label"},"今日成功率",-1)),s("div",Q,o(b.value)+"%",1),s("div",U,[a(u,null,{default:l(()=>[a(g)]),_:1}),e[2]||(e[2]=r(" 良好 ",-1))])]),s("div",j,[e[4]||(e[4]=s("div",{class:"stat-label"},"节点覆盖",-1)),s("div",J,o(T.value),1),e[5]||(e[5]=s("div",{class:"stat-trend neutral"},"可用/总数",-1))]),s("div",K,[e[6]||(e[6]=s("div",{class:"stat-label"},"定时任务",-1)),s("div",O,o(k.value),1),s("div",W,o(D.value)+" 个已启用 ",1)])]),s("div",X,[e[7]||(e[7]=s("div",{class:"section-header"},[s("h3",{class:"section-title"},"最近任务")],-1)),s("div",Y,[a(_,{data:y.value,style:{width:"100%"}},{default:l(()=>[a(n,{prop:"taskId",label:"任务ID",width:"180"}),a(n,{prop:"status",label:"状态",width:"100"},{default:l(({row:t})=>[a(h,{type:t.status==="completed"?"success":t.status==="failed"?"danger":"info"},{default:l(()=>[r(o(t.status),1)]),_:2},1032,["type"])]),_:1}),a(n,{prop:"images",label:"镜像"},{default:l(({row:t})=>[r(o(t.images[0])+" ",1),t.images.length>1?(C(),w("span",Z,"+"+o(t.images.length-1),1)):E("",!0)]),_:1}),a(n,{prop:"progress.percentage",label:"进度",width:"120"},{default:l(({row:t})=>[r(o(t.progress?.percentage?.toFixed(1)||0)+"% ",1)]),_:1}),a(n,{prop:"createdAt",label:"创建时间",width:"180"},{default:l(({row:t})=>[r(o(new Date(t.createdAt).toLocaleString()),1)]),_:1})]),_:1},8,["data"])])])])),[[m,p.value]])}}}),ot=q($,[["__scopeId","data-v-3b990eaa"]]);export{ot as default};
