import{t as S,s as x}from"./index-HqSX5ej0.js";import{d as N,A as $,H as B,I as E,a as A,b as s,D as l,f as a,w as n,j as d,r,E as M,i as c,J as R,o as I,C as z}from"./element-plus-DT46MLQ6.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";const F={class:"dashboard"},H={class:"dashboard-grid"},J={class:"stat-card primary"},L={class:"stat-value"},P={class:"stat-trend neutral"},U={class:"stat-card success"},q={class:"stat-value"},G={class:"stat-trend"},K={class:"stat-card info"},O={class:"stat-value"},Q={class:"stat-card warning"},W={class:"stat-value"},X={class:"stat-trend neutral"},Y={class:"card"},Z={class:"section-header"},tt={class:"section-actions"},st={class:"table-container"},et={key:0},at=N({__name:"DashboardView",setup(ot){const g=r(!1),k=r(0),D=r(0),V=r("0/0"),w=r(0),y=r(0),C=r([]);let f=null;const T=async()=>{try{g.value=!0;const[u,t]=await Promise.all([S.list({limit:1e3}),x.list({limit:100})]),_=u?.tasks||[],v=t?.tasks||[],h=_.filter(o=>o.status==="running").length,m=_.filter(o=>o.status==="pending").length;k.value=h+m;const i=new Date().toDateString(),p=_.filter(o=>new Date(o.createdAt).toDateString()===i),b=p.filter(o=>o.status==="completed").length;D.value=p.length>0?Math.round(b/p.length*100):100,w.value=v.length,y.value=v.filter(o=>o.enabled).length,C.value=_.slice(0,5)}catch(u){console.error("Dashboard loading error:",u),M.error("加载Dashboard失败")}finally{g.value=!1}};return $(()=>{T(),f=window.setInterval(()=>{T()},5e3)}),B(()=>{f&&clearInterval(f)}),(u,t)=>{const _=c("Clock"),v=c("el-icon"),h=c("TrendCharts"),m=c("el-button"),i=c("el-table-column"),p=c("el-tag"),b=c("el-table"),o=R("loading");return E((I(),A("div",F,[s("div",H,[s("div",J,[t[3]||(t[3]=s("div",{class:"stat-label"},"运行中任务",-1)),s("div",L,l(k.value),1),s("div",P,[a(v,null,{default:n(()=>[a(_)]),_:1}),t[2]||(t[2]=d(" 实时更新 ",-1))])]),s("div",U,[t[5]||(t[5]=s("div",{class:"stat-label"},"今日成功率",-1)),s("div",q,l(D.value)+"%",1),s("div",G,[a(v,null,{default:n(()=>[a(h)]),_:1}),t[4]||(t[4]=d(" 良好 ",-1))])]),s("div",K,[t[6]||(t[6]=s("div",{class:"stat-label"},"节点覆盖",-1)),s("div",O,l(V.value),1),t[7]||(t[7]=s("div",{class:"stat-trend neutral"},"可用/总数",-1))]),s("div",Q,[t[8]||(t[8]=s("div",{class:"stat-label"},"定时任务",-1)),s("div",W,l(w.value),1),s("div",X,l(y.value)+" 个已启用 ",1)])]),s("div",Y,[s("div",Z,[t[11]||(t[11]=s("h3",{class:"section-title"},"最近任务",-1)),s("div",tt,[a(m,{type:"primary",size:"small",onClick:t[0]||(t[0]=e=>u.$router.push("/tasks"))},{default:n(()=>[...t[9]||(t[9]=[d(" 新建任务 ",-1)])]),_:1}),a(m,{size:"small",onClick:t[1]||(t[1]=e=>u.$router.push("/tasks"))},{default:n(()=>[...t[10]||(t[10]=[d(" 查看全部 ",-1)])]),_:1})])]),s("div",st,[a(b,{data:C.value,style:{width:"100%"}},{default:n(()=>[a(i,{prop:"taskId",label:"任务ID",width:"180"}),a(i,{prop:"status",label:"状态",width:"100"},{default:n(({row:e})=>[a(p,{type:e.status==="completed"?"success":e.status==="failed"?"danger":"info"},{default:n(()=>[d(l(e.status),1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"images",label:"镜像"},{default:n(({row:e})=>[d(l(e.images[0])+" ",1),e.images.length>1?(I(),A("span",et,"+"+l(e.images.length-1),1)):z("",!0)]),_:1}),a(i,{prop:"progress.percentage",label:"进度",width:"120"},{default:n(({row:e})=>[d(l(e.progress?.percentage?.toFixed(1)||0)+"% ",1)]),_:1}),a(i,{prop:"createdAt",label:"创建时间",width:"180"},{default:n(({row:e})=>[d(l(new Date(e.createdAt).toLocaleString()),1)]),_:1})]),_:1},8,["data"])])])])),[[o,g.value]])}}}),it=j(at,[["__scopeId","data-v-a4d2380b"]]);export{it as default};
