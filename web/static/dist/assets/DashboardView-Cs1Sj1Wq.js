import{t as x,s as V}from"./index-azKvCBLj.js";import{d as S,A as I,H as N,I as B,a as y,b as s,D as o,f as a,w as l,j as r,r as d,E,i as c,J as M,o as C,C as R}from"./element-plus-DT46MLQ6.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";const F={class:"dashboard"},H={class:"dashboard-grid"},J={class:"stat-card primary"},L={class:"stat-value"},P={class:"stat-trend neutral"},U={class:"stat-card success"},q={class:"stat-value"},z={class:"stat-trend"},G={class:"stat-card info"},K={class:"stat-value"},O={class:"stat-card warning"},Q={class:"stat-value"},W={class:"stat-trend neutral"},X={class:"card"},Y={class:"table-container"},Z={key:0},$=S({__name:"DashboardView",setup(tt){const v=d(!1),f=d(0),b=d(0),T=d("0/0"),k=d(0),D=d(0),w=d([]),A=async()=>{try{v.value=!0;const[p,e]=await Promise.all([x.list({limit:1e3}),V.list({limit:100})]),i=p?.tasks||[],u=e?.tasks||[],g=i.filter(t=>t.status==="running").length,n=i.filter(t=>t.status==="pending").length;f.value=g+n;const h=new Date().toDateString(),_=i.filter(t=>new Date(t.createdAt).toDateString()===h),m=_.filter(t=>t.status==="completed").length;b.value=_.length>0?Math.round(m/_.length*100):100,k.value=u.length,D.value=u.filter(t=>t.enabled).length,w.value=i.slice(0,5)}catch(p){console.error("Dashboard loading error:",p),E.error("加载Dashboard失败")}finally{v.value=!1}};return I(()=>{A()}),N(()=>{}),(p,e)=>{const i=c("Clock"),u=c("el-icon"),g=c("TrendCharts"),n=c("el-table-column"),h=c("el-tag"),_=c("el-table"),m=M("loading");return B((C(),y("div",F,[s("div",H,[s("div",J,[e[1]||(e[1]=s("div",{class:"stat-label"},"运行中任务",-1)),s("div",L,o(f.value),1),s("div",P,[a(u,null,{default:l(()=>[a(i)]),_:1}),e[0]||(e[0]=r(" 实时更新 ",-1))])]),s("div",U,[e[3]||(e[3]=s("div",{class:"stat-label"},"今日成功率",-1)),s("div",q,o(b.value)+"%",1),s("div",z,[a(u,null,{default:l(()=>[a(g)]),_:1}),e[2]||(e[2]=r(" 良好 ",-1))])]),s("div",G,[e[4]||(e[4]=s("div",{class:"stat-label"},"节点覆盖",-1)),s("div",K,o(T.value),1),e[5]||(e[5]=s("div",{class:"stat-trend neutral"},"可用/总数",-1))]),s("div",O,[e[6]||(e[6]=s("div",{class:"stat-label"},"定时任务",-1)),s("div",Q,o(k.value),1),s("div",W,o(D.value)+" 个已启用 ",1)])]),s("div",X,[e[7]||(e[7]=s("div",{class:"section-header"},[s("h3",{class:"section-title"},"最近任务")],-1)),s("div",Y,[a(_,{data:w.value,style:{width:"100%"}},{default:l(()=>[a(n,{prop:"taskId",label:"任务ID",width:"180"}),a(n,{prop:"status",label:"状态",width:"100"},{default:l(({row:t})=>[a(h,{type:t.status==="completed"?"success":t.status==="failed"?"danger":"info"},{default:l(()=>[r(o(t.status),1)]),_:2},1032,["type"])]),_:1}),a(n,{prop:"images",label:"镜像"},{default:l(({row:t})=>[r(o(t.images[0])+" ",1),t.images.length>1?(C(),y("span",Z,"+"+o(t.images.length-1),1)):R("",!0)]),_:1}),a(n,{prop:"progress.percentage",label:"进度",width:"120"},{default:l(({row:t})=>[r(o(t.progress?.percentage?.toFixed(1)||0)+"% ",1)]),_:1}),a(n,{prop:"createdAt",label:"创建时间",width:"180"},{default:l(({row:t})=>[r(o(new Date(t.createdAt).toLocaleString()),1)]),_:1})]),_:1},8,["data"])])])])),[[m,v.value]])}}}),ot=j($,[["__scopeId","data-v-231525c6"]]);export{ot as default};
