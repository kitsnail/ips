import{l as v}from"./index-D5L2XjAQ.js";import{d as E,G as L,H as M,I as N,g as U,j as _,k as l,l as t,r as f,E as r,q as s,J as q,t as j,v as d,C as b,K as x}from"./element-plus-D4iBZxCD.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const G={class:"library"},H={class:"header"},J={class:"actions"},K={style:{"font-family":"monospace",color:"#0891b2"}},T=E({__name:"LibraryView",setup(F){const g=f(!1),y=f([]),u=f(!1),n=f([]);let w=null;const i=f({name:"",image:""}),m=async()=>{try{g.value=!0;const o=await v.list({limit:100,offset:0});y.value=o.images}catch{r.error("加载镜像库失败")}finally{g.value=!1}},C=async()=>{try{await v.create(i.value),r.success("镜像添加成功"),u.value=!1,i.value={name:"",image:""},m()}catch{r.error("添加镜像失败")}},k=async o=>{try{await x.confirm("确定要删除这个镜像吗？","确认删除",{type:"warning"}),await v.delete(o.id),r.success("镜像已删除"),m()}catch(e){e!=="cancel"&&r.error("删除失败")}},I=async()=>{if(n.value.length===0){r.warning("请先选择要删除的镜像");return}try{await x.confirm(`确定要删除选中的 ${n.value.length} 个镜像吗？`,"确认删除",{type:"warning"});for(const o of n.value)await v.delete(o);r.success(`成功删除 ${n.value.length} 个镜像`),n.value=[],m()}catch(o){o!=="cancel"&&r.error("批量删除失败")}},A=o=>{o?n.value=y.value.map(e=>e.id):n.value=[]};return L(()=>{m(),w=window.setInterval(()=>{m()},5e3)}),M(()=>{w&&clearInterval(w)}),(o,e)=>{const c=s("el-button"),p=s("el-table-column"),D=s("el-table"),h=s("el-input"),V=s("el-form-item"),B=s("el-form"),S=s("el-dialog"),$=q("loading");return N((j(),U("div",G,[_("div",H,[e[7]||(e[7]=_("h2",null,"镜像库管理",-1)),_("div",J,[l(c,{type:"danger",disabled:n.value.length===0,onClick:I},{default:t(()=>[d(" 批量删除 ("+b(n.value.length)+") ",1)]),_:1},8,["disabled"]),l(c,{type:"primary",onClick:e[0]||(e[0]=a=>u.value=!0)},{default:t(()=>[...e[6]||(e[6]=[d(" 添加镜像 ",-1)])]),_:1})])]),l(D,{data:y.value,onSelectionChange:e[1]||(e[1]=a=>n.value=a),style:{width:"100%"}},{default:t(()=>[l(p,{type:"selection",width:"55",onSelectAll:A}),l(p,{prop:"name",label:"显示名称",width:"200"}),l(p,{prop:"image",label:"镜像地址","min-width":"300"},{default:t(({row:a})=>[_("span",K,b(a.image),1)]),_:1}),l(p,{prop:"createdAt",label:"添加时间",width:"180"},{default:t(({row:a})=>[d(b(new Date(a.createdAt).toLocaleString()),1)]),_:1}),l(p,{label:"操作",width:"100",fixed:"right"},{default:t(({row:a})=>[l(c,{size:"small",type:"danger",onClick:O=>k(a)},{default:t(()=>[...e[8]||(e[8]=[d(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),l(S,{modelValue:u.value,"onUpdate:modelValue":e[5]||(e[5]=a=>u.value=a),title:"添加镜像",width:"500px"},{footer:t(()=>[l(c,{onClick:e[4]||(e[4]=a=>u.value=!1)},{default:t(()=>[...e[9]||(e[9]=[d("取消",-1)])]),_:1}),l(c,{type:"primary",onClick:C},{default:t(()=>[...e[10]||(e[10]=[d("添加",-1)])]),_:1})]),default:t(()=>[l(B,{"label-width":"100px"},{default:t(()=>[l(V,{label:"显示名称",required:""},{default:t(()=>[l(h,{modelValue:i.value.name,"onUpdate:modelValue":e[2]||(e[2]=a=>i.value.name=a),placeholder:"例如：Nginx"},null,8,["modelValue"])]),_:1}),l(V,{label:"镜像地址",required:""},{default:t(()=>[l(h,{modelValue:i.value.image,"onUpdate:modelValue":e[3]||(e[3]=a=>i.value.image=a),placeholder:"docker.io/library/nginx:latest"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),[[$,g.value]])}}}),W=z(T,[["__scopeId","data-v-ae400e8c"]]);export{W as default};
