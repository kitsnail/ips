<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>镜像预热服务 (IPS) - 管理控制台</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* IPS Design System - Updated */
        :root {
            /* Primary Colors - Cyan based */
            --primary-color: #0891b2;
            --primary-hover: #0e7490;
            --primary-light: #ecfeff;
            --primary-lighter: #cffafe;

            /* Secondary Colors */
            --secondary-color: #22d3ee;
            --success-color: #22c55e;
            --warning-color: #f59e0b;
            --error-color: #ef4444;

            /* Neutral Colors */
            --bg-color: #f8fafc;
            --bg-card: #ffffff;
            --text-main: #0f172a;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --border-color: #e2e8f0;
            --border-light: #f1f5f9;

            /* Glass Effect */
            --glass-bg: rgba(255, 255, 255, 0.9);
            --glass-blur: 12px;

            /* Shadows */
            --sha-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --sha-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --sha-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --sha-primary: 0 4px 12px rgba(8, 145, 178, 0.15);
        }

        body {
            background-color: var(--bg-color);
            background-image: radial-gradient(#cffafe 1px, transparent 1px);
            background-size: 24px 24px;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            color: var(--text-main);
            -webkit-font-smoothing: antialiased;
            line-height: 1.5;
        }

        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--glass-bg);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--sha-sm);
            height: 64px;
        }

        .header .container {
            display: flex;
            /* Flex container for header content */
            align-items: center;
            justify-content: space-between;
            height: 100%;
            padding: 0 24px;
            max-width: 1440px;
            margin: 0 auto;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-main);
            margin-right: 48px;
            display: flex;
            align-items: center;
            gap: 12px;
            letter-spacing: -0.025em;
        }

        .header h1::before {
            content: '';
            display: block;
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            border-radius: 8px;
            box-shadow: 0 0 0 1px rgba(8, 145, 178, 0.1), 0 4px 6px -1px rgba(8, 145, 178, 0.2);
        }

        .nav-tabs {
            display: flex;
            /* FIX: Added flex to correctly layout items */
            gap: 8px;
            margin-right: auto;
            height: 100%;
            align-items: center;
        }

        .nav-link {
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 14px;
            padding: 6px 16px;
            height: 36px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
        }

        .nav-link:hover {
            color: var(--text-main);
            background: rgba(15, 23, 42, 0.05);
            /* Slate 900 5% */
        }

        .nav-link.active {
            color: var(--primary-color);
            background: #eef2ff;
            /* Indigo 50 */
            font-weight: 600;
        }

        /* Profile Section */
        #userInfo {
            font-size: 14px;
            color: var(--text-main);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        #userInfo a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.2s;
        }

        #userInfo a:hover {
            color: #ef4444;
        }

        .container {
            max-width: 1440px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        /* Card Style update */
        .card,
        .task-list {
            background: white;
            border-radius: 16px;
            /* Larger radius for modern feel */
            box-shadow: var(--sha-md);
            border: 1px solid var(--border-color);
            padding: 0;
            overflow: hidden;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .action-bar {
            background: white;
            border-radius: 16px;
            padding: 16px 24px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: var(--sha-sm);
            border: 1px solid var(--border-color);
        }

        /* Button Refinement */
        .btn {
            font-weight: 600;
            border-radius: 8px;
            padding: 9px 20px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 14px;
            cursor: pointer;
            border: 1px solid transparent;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            white-space: nowrap;
            /* Prevent vertical text */
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
            box-shadow: var(--sha-primary);
        }

        .btn-primary:hover {
            background: var(--primary-hover);
            box-shadow: 0 6px 12px rgba(8, 145, 178, 0.25);
        }

        .btn-secondary {
            background: white;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            box-shadow: var(--sha-sm);
        }

        .btn-secondary:hover {
            background: #f8fafc;
            color: var(--text-main);
            border-color: #cbd5e1;
        }

        .btn-danger {
            background: white;
            border: 1px solid #fee2e2;
            color: #dc2626;
            box-shadow: var(--sha-sm);
        }

        .btn-danger:hover {
            background: #fef2f2;
            border-color: #fecaca;
        }

        .btn-sm {
            padding: 5px 12px;
            font-size: 12px;
            height: 28px;
        }

        .icon {
            width: 16px;
            height: 16px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        /* Dashboard Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
            box-shadow: var(--sha-sm);
            transition: box-shadow 0.2s ease;
        }

        .stat-card:hover {
            box-shadow: var(--sha-md);
        }

        .stat-card .stat-label {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
            margin-bottom: 8px;
        }

        .stat-card .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-main);
            line-height: 1;
            margin-bottom: 4px;
        }

        .stat-card .stat-trend {
            font-size: 12px;
            color: var(--success-color);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .stat-card .stat-trend.neutral {
            color: var(--text-muted);
        }

        .stat-card .stat-trend.down {
            color: var(--error-color);
        }

        .stat-card.primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
            color: white;
        }

        .stat-card.primary .stat-label,
        .stat-card.primary .stat-value {
            color: white;
        }

        .stat-card.success {
            border-left: 3px solid var(--success-color);
        }

        .stat-card.warning {
            border-left: 3px solid var(--warning-color);
        }

        .stat-card.info {
            border-left: 3px solid var(--primary-color);
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-main);
        }

        .section-actions {
            display: flex;
            gap: 8px;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: none;
        }

        .status-badge.bg-pending {
            background: var(--warning-color);
            color: white;
        }

        .status-badge.bg-running {
            background: var(--primary-color);
            color: white;
        }

        .status-badge.bg-completed {
            background: var(--success-color);
            color: white;
        }

        .status-badge.bg-failed {
            background: var(--error-color);
            color: white;
        }

        .status-badge.bg-cancelled {
            background: var(--text-muted);
            color: white;
        }

        .status-badge.bg-enabled {
            background: var(--success-color);
            color: white;
        }

        .status-badge.bg-disabled {
            background: var(--text-muted);
            color: white;
        }

        .progress-ring {
            position: relative;
            width: 40px;
            height: 40px;
        }

        .progress-ring svg {
            transform: rotate(-90deg);
        }

        .progress-ring circle {
            fill: none;
            stroke-width: 4;
        }

        .progress-ring .bg {
            stroke: var(--border-color);
        }

        .progress-ring .progress {
            stroke: var(--primary-color);
            stroke-linecap: round;
            transition: stroke-dashoffset 0.3s ease;
        }

        .progress-ring .value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 11px;
            font-weight: 600;
            color: var(--text-main);
        }

        .action-dropdown {
            position: relative;
            display: inline-block;
        }

        .action-dropdown-menu {
            position: absolute;
            right: 0;
            top: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: var(--sha-lg);
            min-width: 140px;
            z-index: 1000;
            display: none;
            padding: 8px 0;
        }

        .action-dropdown-menu.show {
            display: block;
        }

        .action-dropdown-item {
            display: block;
            width: 100%;
            text-align: left;
            padding: 8px 16px;
            font-size: 13px;
            color: var(--text-main);
            cursor: pointer;
            transition: background 0.15s ease;
        }

        .action-dropdown-item:hover {
            background: var(--primary-light);
            color: var(--primary-color);
        }

        .action-dropdown-item.danger {
            color: var(--error-color);
        }

        .action-dropdown-item.danger:hover {
            background: #fef2f2;
        }

        .task-row .image-cell {
            position: relative;
        }

        .task-row .tooltip {
            position: absolute;
            top: 0;
            left: 100%;
            background: var(--text-main);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            z-index: 1000;
            display: none;
            margin-left: 8px;
            box-shadow: var(--sha-md);
            max-width: 400px;
            white-space: normal;
        }

        .task-row .tooltip::after {
            content: '';
            position: absolute;
            top: 12px;
            left: -6px;
            transform: translateY(-50%);
            border: 6px solid transparent;
            border-right-color: var(--text-main);
        }

        .task-row .tooltip-trigger:hover .tooltip {
            display: block;
        }

        .modal-content {
            max-height: 80vh;
            overflow-y: auto;
        }

        .form-section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .form-section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-main);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .form-section-toggle {
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-secondary);
            font-size: 13px;
        }

        .form-section-toggle:hover {
            color: var(--primary-color);
        }

        .form-section-toggle svg {
            transition: transform 0.2s ease;
        }

        .form-section-toggle.collapsed svg {
            transform: rotate(-90deg);
        }

        .form-section-content {
            display: block;
        }

        .form-section-content.collapsed {
            display: none;
        }

        .create-grid {
            display: grid;
            grid-template-columns: 1fr 300px 240px;
            gap: 20px;
        }

        .config-pane {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .editor-pane {
            display: flex;
            flex-direction: column;
        }

        .library-picker-pane {
            display: flex;
            flex-direction: column;
        }

        .node-status-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-card);
            border-radius: 8px;
            overflow: hidden;
        }

        .node-status-table thead {
            background: var(--primary-light);
        }

        .node-status-table thead th {
            padding: 12px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-main);
            border-bottom: 1px solid var(--border-color);
        }

        .node-status-table tbody tr {
            border-bottom: 1px solid var(--border-light);
        }

        .node-status-table tbody tr:last-child {
            border-bottom: none;
        }

        .node-status-table tbody tr:hover {
            background: var(--primary-lighter);
        }

        .node-status-table td {
            padding: 12px;
            font-size: 13px;
        }

        .node-name-cell {
            font-weight: 500;
            color: var(--text-main);
            width: 30%;
        }

        .image-tag-success {
            display: inline-block;
            padding: 2px 8px;
            background: var(--success-color);
            color: white;
            border-radius: 4px;
            font-size: 11px;
            margin-right: 6px;
            margin-bottom: 4px;
        }

        .image-tag-failed {
            display: inline-block;
            padding: 2px 8px;
            background: var(--error-color);
            color: white;
            border-radius: 4px;
            font-size: 11px;
            margin-right: 6px;
            margin-bottom: 4px;
        }

        .detail-row {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 0;
        }

        .failed-nodes {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }

        .failed-node-item {
            padding: 8px 0;
            border-bottom: 1px solid #fecaca;
            font-size: 13px;
        }

        .failed-node-item:last-child {
            border-bottom: none;
        }
    </style>
</head>

<body>
    <div class="header">
        <div class="container">
            <h1>镜像预热控制台（IPS）</h1>
            <nav class="nav-tabs">
                <a class="nav-link active" onclick="switchTab('dashboard')">概览</a>
                <a class="nav-link" onclick="switchTab('tasks')">任务管理</a>
                <a class="nav-link" onclick="switchTab('scheduled')">定时任务</a>
                <a class="nav-link" onclick="switchTab('library')">镜像库</a>
                <a class="nav-link" onclick="switchTab('secrets')">仓库认证</a>
                <a class="nav-link" id="adminTab" onclick="switchTab('admin')" style="display: none;">系统设置</a>
            </nav>
            <div id="userInfo">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <div style="width: 32px; height: 32px; background: #bfdbfe; color: #1e40af; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600;"
                        id="userAvatar">U</div>
                    <span id="currentUsername"></span>
                </div>
                <div style="height: 16px; width: 1px; background: #e5e7eb;"></div>
                <a href="#" onclick="showChangeMyPasswordModal()">修改密码</a>
                <div style="height: 16px; width: 1px; background: #e5e7eb;"></div>
                <a href="#" onclick="logout()">退出登录</a>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Dashboard面板 -->
        <div id="dashboardPanel" class="tab-panel active">
            <!-- 统计卡片 -->
            <div class="dashboard-grid">
                <div class="stat-card primary">
                    <div class="stat-label">运行中任务</div>
                    <div class="stat-value" id="statRunningTasks">0</div>
                    <div class="stat-trend neutral">
                        <svg class="icon" style="width: 14px; height: 14px;" viewBox="0 0 24 24">
                            <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        实时更新
                    </div>
                </div>
                <div class="stat-card success">
                    <div class="stat-label">今日成功率</div>
                    <div class="stat-value" id="statSuccessRate">0%</div>
                    <div class="stat-trend" id="statTrend">
                        <svg class="icon" style="width: 14px; height: 14px;" viewBox="0 0 24 24">
                            <path d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                        </svg>
                        <span id="statTrendText">--</span>
                    </div>
                </div>
                <div class="stat-card info">
                    <div class="stat-label">节点覆盖</div>
                    <div class="stat-value" id="statNodes">0/0</div>
                    <div class="stat-trend neutral">可用/总数</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-label">定时任务</div>
                    <div class="stat-value" id="statScheduled">0</div>
                    <div class="stat-trend neutral">
                        <span id="statScheduledActive">0</span> 个已启用
                    </div>
                </div>
            </div>

            <!-- 最近任务 -->
            <div class="card" style="padding: 0;">
                <div class="section-header" style="padding: 20px 24px; border-bottom: 1px solid var(--border-color);">
                    <h2 class="section-title">最近任务</h2>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="showCreateTaskModal()">新建任务</button>
                        <button class="btn btn-secondary" onclick="switchTab('tasks')">查看全部</button>
                    </div>
                </div>
                <div style="padding: 0 24px 24px 24px;">
                    <div id="recentTasksList">
                        <div style="text-align: center; color: var(--text-muted); padding: 60px 0;">加载中...</div>
                    </div>
                </div>
            </div>
        </div>


          <!-- Task Management Panel -->
          <div id="tasksPanel" class="tab-panel" style="display: none;">
             <div class="action-bar">
                 <button class="btn btn-primary" onclick="showCreateTaskModal()">
                     <svg class="icon" viewBox="0 0 24 24">
                         <path d="M12 4.5v15m7.5-7.5-7.5 19 0 1.414 1.414L19 12l-4.243-4.243a5 5 5 0 0 5 5 0 0 5z" />
                     </svg>
                     新建任务
                 </button>
                 <button id="batchDeleteBtn" class="btn btn-danger" style="display: none; margin-left: 12px;" onclick="executeBatchDelete()">
                     <svg class="icon" viewBox="0 0 24 24">
                         <path d="M14.74 9.93l-2.69-9.93-13.78 13.78 2.69 2.69 13.78 13.78 5.41 0 5.41-13.78 13.78 0 5.41 5.41-0 0-5.41-5.41 0-5.41z" />
                     </svg>
                     批量删除
                  </button>
              </div>
          </div>

         <!-- 创建定时任务模态框 -->
         <div id="createScheduledTaskModal" class="modal">
             <div class="modal-content">
                 <div class="modal-header">创建定时任务</div>
                 <div class="modal-body">
                     <form id="createScheduledTaskForm" onsubmit="createScheduledTask(event)">
                         <div class="form-section">
                             <div class="form-section-title">
                                 <span>基本信息</span>
                             </div>
                             <div class="config-pane" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                                 <div class="form-group">
                                     <label class="form-label">任务名称 *</label>
                                     <input type="text" id="scheduledName" class="form-input" required placeholder="例如：每日镜像预热">
                                 </div>
                                 <div class="form-group">
                                     <label class="form-label">启用任务</label>
                                     <select id="scheduledEnabled" class="form-input">
                                         <option value="true">是</option>
                                         <option value="false">否</option>
                                     </select>
                                 </div>
                             </div>
                         </div>

                         <div class="form-section">
                             <div class="form-section-title">
                                 <span>Cron 表达式</span>
                             </div>
                             <div class="config-pane">
                                 <div class="form-group">
                                     <label class="form-label">Cron 表达式 *</label>
                                     <div style="display: flex; gap: 12px;">
                                         <input type="text" id="scheduledCron" class="form-input" required placeholder="0 2 * * *" style="font-family: monospace; flex: 1;">
                                         <select id="cronTemplate" class="form-input" style="flex: 0 0 auto; min-width: 220px;" onchange="applyCronTemplate()">
                                             <option value="">-- 选择模板 --</option>
                                             <option value="0 2 * * *">每天凌晨2点</option>
                                             <option value="0 * * * *">每小时执行</option>
                                             <option value="0 9 * * 1">每周一上午9点</option>
                                             <option value="*/15 * * * *">每15分钟</option>
                                             <option value="0 0 * * *">每天午夜</option>
                                             <option value="0 */2 * * *">每2小时</option>
                                         </select>
                                     </div>
                                     <div id="nextExecutionPreview" style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;"></div>
                                 </div>
                             </div>
                         </div>

                         <div class="form-section">
                             <div class="form-section-title">
                                 <span>任务配置</span>
                             </div>
                             <div class="config-pane" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                                 <div class="form-group">
                                     <label class="form-label">镜像列表 *</label>
                                     <textarea id="scheduledImages" class="form-input" rows="4" required placeholder="docker.io/library/nginx:latest, docker.io/library/redis:7" style="font-family: monospace;"></textarea>
                                     <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">多个镜像用逗号分隔</div>
                                 </div>
                                 <div class="form-group">
                                     <label class="form-label">批次大小</label>
                                     <input type="number" id="scheduledBatchSize" class="form-input" value="10" min="1" max="100">
                                 </div>
                             </div>
                         </div>

                         <div class="form-section">
                             <div class="form-section-title">
                                 <span>高级配置</span>
                             </div>
                             <div class="config-pane" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                                 <div class="form-group">
                                     <label class="form-label">重叠策略</label>
                                     <select id="scheduledOverlap" class="form-input">
                                         <option value="skip">跳过（不执行）</option>
                                         <option value="allow">允许（排队）</option>
                                     </select>
                                 </div>
                                 <div class="form-group">
                                     <label class="form-label">超时时间（秒，0表示不限制）</label>
                                     <input type="number" id="scheduledTimeout" class="form-input" value="0" min="0" max="86400">
                                 </div>
                             </div>
                         </div>
                     </form>
                 </div>
                 <div class="form-actions">
                     <button type="button" class="btn btn-secondary" onclick="hideCreateScheduledTaskModal()">取消</button>
                     <button type="button" class="btn btn-primary" onclick="document.getElementById('createScheduledTaskForm').requestSubmit()">创建任务</button>
                 </div>
             </div>
         </div>

         <!-- 镜像库面板 -->
        <div id="libraryPanel" class="tab-panel" style="display: none;">
            <div class="action-bar">
                <button class="btn btn-primary" onclick="showAddLibraryImageModal()">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    添加镜像
                </button>
                <button id="libBatchDeleteBtn" class="btn btn-danger" onclick="executeLibBatchDelete()"
                    style="display: none;">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path
                            d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                    </svg>
                    批量删除
                </button>
                <div style="margin-left: auto; color: #64748b; font-size: 14px; font-weight: 500;">常用镜像库</div>
            </div>

            <div class="card" style="padding: 0;">
                <div class="table-container">
                    <table class="data-grid">
                        <thead>
                            <tr>
                                <th class="col-checkbox"><input type="checkbox" id="libSelectAll"
                                        onchange="toggleLibSelectAll()"></th>
                                <th>显示名称</th>
                                <th>镜像地址</th>
                                <th>添加时间</th>
                                <th style="width: 120px;">操作</th>
                            </tr>
                        </thead>
                        <tbody id="libraryListBody">
                            <!-- 镜像数据动态加载 -->
                        </tbody>
                    </table>
                </div>
                <!-- 分页控制区 -->
                <div class="pagination-footer">
                    <div class="pagination-info">
                        显示 <span id="libPageStart">0</span> - <span id="libPageEnd">0</span> 共 <span
                            id="libTotalItems">0</span> 项
                    </div>
                    <div class="pagination-controls">
                        <span style="font-size: 13px; color: #64748b;">每页</span>
                        <select id="libPageSizeSelect" class="form-input" style="width: auto; padding: 4px 8px;"
                            onchange="changeLibPageSize()">
                            <option value="10">10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                        </select>
                        <button id="libPrevBtn" class="btn btn-secondary btn-sm" onclick="libPrevPage()"
                            disabled>上一页</button>
                        <span style="font-size: 13px; color: #111827;">第 <span id="libCurrentPageNum">1</span> 页</span>
                        <button id="libNextBtn" class="btn btn-secondary btn-sm" onclick="libNextPage()">下一页</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 仓库认证面板 -->
        <div id="secretsPanel" class="tab-panel" style="display: none;">
            <div class="action-bar">
                <button class="btn btn-primary" onclick="showCreateSecretModal()">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    添加认证
                </button>
                <button id="secretBatchDeleteBtn" class="btn btn-danger" onclick="executeSecretBatchDelete()"
                    style="display: none;">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path
                            d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                    </svg>
                    批量删除
                </button>
                <div style="margin-left: auto; color: #64748b; font-size: 14px; font-weight: 500;">私有仓库认证管理</div>
            </div>

            <div class="card" style="padding: 0;">
                <div class="table-container">
                    <table class="data-grid">
                        <thead>
                            <tr>
                                <th class="col-checkbox"><input type="checkbox" id="secretSelectAll"
                                        onchange="toggleSecretSelectAll()"></th>
                                <th>名称</th>
                                <th>镜像仓库地址</th>
                                <th>用户名</th>
                                <th>创建时间</th>
                                <th style="width: 120px;">操作</th>
                            </tr>
                        </thead>
                        <tbody id="secretListBody">
                            <!-- 认证数据动态加载 -->
                        </tbody>
                    </table>
                </div>
                <div class="pagination-footer">
                    <div class="pagination-info">
                        显示 <span id="secretPageStart">0</span> - <span id="secretPageEnd">0</span> 共 <span
                            id="secretTotalItems">0</span> 项
                    </div>
                    <div class="pagination-controls">
                        <span style="font-size: 13px; color: #64748b;">每页</span>
                        <select id="secretPageSizeSelect" class="form-input" style="width: auto; padding: 4px 8px;"
                            onchange="changeSecretPageSize()">
                            <option value="10">10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                        </select>
                        <button id="secretPrevBtn" class="btn btn-secondary btn-sm" onclick="secretPrevPage()"
                            disabled>上一页</button>
                        <span style="font-size: 13px; color: #111827;">第 <span id="secretCurrentPageNum">1</span>
                            页</span>
                        <button id="secretNextBtn" class="btn btn-secondary btn-sm"
                            onclick="secretNextPage()">下一页</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- 创建任务模态框 -->
        <div id="createModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">创建镜像预热任务</div>
                <div class="modal-body">
                    <form id="createTaskForm" onsubmit="createTask(event)">
                        <div class="form-section">
                            <div class="form-section-title">
                                镜像列表
                            </div>
                            <div class="create-grid">
                                <div class="editor-pane">
                                    <label class="form-label">镜像列表 * (每行一个镜像)</label>
                                    <textarea class="form-input" id="images" rows="12"
                                        placeholder="docker.io/library/nginx:latest&#10;registry.hub.docker.com/library/redis:7"
                                        required></textarea>
                                </div>
                                <div class="library-picker-pane">
                                    <label class="form-label">从镜像库选择</label>
                                    <div id="quickLibraryList"
                                        style="flex: 1; overflow-y: auto; background: #f8fafc; border: 1px solid #e5e7eb; border-radius: 6px; padding: 8px; min-height: 280px;">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <div class="form-section-title">
                                <span>基础配置</span>
                            </div>
                            <div class="config-pane" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                                <div class="form-group">
                                    <label class="form-label">批次大小 *</label>
                                    <input type="number" class="form-input" id="batchSize" value="10" min="1" max="100" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">优先级 (1-10，默认5)</label>
                                    <input type="number" class="form-input" id="priority" value="5" min="1" max="10">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <div class="form-section-title">
                                <span>高级配置</span>
                                <span class="form-section-toggle" onclick="toggleAdvancedSection()">
                                    <svg class="icon" viewBox="0 0 24 24">
                                        <path d="M6 9l6 6 6-6" />
                                    </svg>
                                </span>
                            </div>
                            <div class="form-section-content" id="advancedSection">
                                <div class="config-pane" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                                    <div class="form-group">
                                        <label class="form-label">最大重试次数 (0-5，默认0)</label>
                                        <input type="number" class="form-input" id="maxRetries" value="0" min="0" max="5">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">重试策略</label>
                                        <select class="form-input" id="retryStrategy">
                                            <option value="linear">线性</option>
                                            <option value="exponential">指数退避</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">重试延迟(秒，默认30)</label>
                                        <input type="number" class="form-input" id="retryDelay" value="30" min="1" max="300">
                                    </div>
                                </div>

                                <div style="border-top: 1px solid var(--border-color); margin-top: 12px; padding-top: 12px;">
                                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                                        <label class="form-label" style="margin-bottom: 0;">私有镜像仓库认证</label>
                                        <label style="font-size: 13px; color: var(--text-secondary); display: flex; align-items: center; gap: 6px; cursor: pointer;">
                                            <input type="checkbox" id="enableRegistry" onchange="toggleRegistryFields()"
                                                style="width: 16px; height: 16px;">
                                            启用
                                        </label>
                                    </div>
                                    <div id="registryFields" style="display: none;">
                                        <div class="form-group" style="margin-bottom: 12px;">
                                            <label class="form-label" style="font-size: 13px; color: var(--text-secondary);">认证方式</label>
                                            <div style="display: flex; gap: 16px; margin-top: 6px;">
                                                <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 13px;">
                                                    <input type="radio" name="authMode" value="manual"
                                                        onchange="toggleAuthMode()" checked
                                                        style="width: 16px; height: 16px;">
                                                    手动输入
                                                </label>
                                                <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 13px;">
                                                    <input type="radio" name="authMode" value="select"
                                                        onchange="toggleAuthMode()" style="width: 16px; height: 16px;">
                                                    选择已保存的认证
                                                </label>
                                            </div>
                                        </div>
                                        <div id="manualAuthFields">
                                            <div class="form-group">
                                                <label class="form-label" style="color: var(--primary-color);">镜像仓库地址 *</label>
                                                <input type="text" class="form-input" id="registry"
                                                    placeholder="harbor.example.com" style="font-family: monospace;">
                                                <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">如: harbor.example.com 或 123456.dkr.ecr.us-west-2.amazonaws.com</div>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label" style="color: var(--primary-color);">用户名 *</label>
                                                <input type="text" class="form-input" id="username" placeholder="your-username">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label" style="color: var(--primary-color);">密码 *</label>
                                                <input type="password" class="form-input" id="password" placeholder="your-password">
                                                <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">密码仅在任务创建时使用，不会保存</div>
                                            </div>
                                        </div>
                                        <div id="selectAuthFields" style="display: none;">
                                            <div class="form-group">
                                                <label class="form-label" style="color: var(--primary-color);">选择认证 *</label>
                                                <select class="form-input" id="selectedSecretId">
                                                    <option value="">-- 请选择认证 --</option>
                                                </select>
                                                <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">选择已保存的仓库认证，密码已安全存储</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="form-actions"><button type="button" class="btn btn-secondary"
                        onclick="hideCreateTaskModal()">取消</button><button type="button" class="btn btn-primary"
                        onclick="document.getElementById('createTaskForm').requestSubmit()">创建任务并开始</button></div>
            </div>
        </div>
        <!-- 创建/编辑仓库认证模态框 -->
        <div id="createSecretModal" class="modal">
            <div class="modal-content" style="height: auto; width: 500px; max-width: 90vw;">
                <div class="modal-header">
                    <span id="secretModalTitle">添加仓库认证</span>
                </div>
                <div class="modal-body">
                    <form id="createSecretForm" onsubmit="saveSecret(event)">
                        <input type="hidden" id="secretId">
                        <div class="form-group">
                            <label class="form-label">认证名称 *</label>
                            <input type="text" id="secretName" class="form-input" required placeholder="例如：Harbor私有仓库">
                        </div>
                        <div class="form-group">
                            <label class="form-label">镜像仓库地址 *</label>
                            <input type="text" id="secretRegistry" class="form-input" required
                                placeholder="harbor.example.com" style="font-family: monospace;">
                            <div style="font-size: 11px; color: #64748b; margin-top: 4px;">如: harbor.example.com 或
                                123456.dkr.ecr.us-west-2.amazonaws.com</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">用户名 *</label>
                            <input type="text" id="secretUsername" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">密码 *</label>
                            <input type="password" id="secretPassword" class="form-input" required>
                            <div id="secretPasswordHint" style="font-size: 11px; color: #64748b; margin-top: 4px;">
                                留空表示不修改密码</div>
                        </div>
                    </form>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="hideCreateSecretModal()">取消</button>
                    <button type="button" class="btn btn-primary"
                        onclick="document.getElementById('createSecretForm').requestSubmit()">保存</button>
                </div>
            </div>
        </div>
        <!-- 任务详情模态框 -->
        <div id="detailModal" class="modal">
            <div class="modal-content">
                <div class="modal-header"><span>任务详情仪表盘</span></div>
                <div class="modal-body" id="taskDetail">
                    <div class="loading">加载详情中...</div>
                </div>
                <div class="form-actions"><button type="button" class="btn btn-secondary"
                        onclick="hideDetailModal()">关闭</button><button type="button" class="btn btn-primary"
                        id="cancelTaskBtn" onclick="cancelCurrentTask()" style="display:none;">取消任务</button></div>
            </div>
        </div>
        <!-- 添加镜像库镜像模态框 -->
        <div id="addLibraryModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">添加常用镜像</div>
                <div class="modal-body">
                    <form id="addLibraryForm" onsubmit="addLibraryImage(event)">
                        <div class="form-group">
                            <label class="form-label">镜像列表 (每行一个镜像)</label>
                            <textarea id="libImages" class="form-input" style="height: 200px; font-family: monospace;"
                                placeholder="docker.io/library/nginx:latest&#10;cr01.home.lan/library/n8n:v0.1.1"
                                required></textarea>
                            <div style="font-size: 11px; color: #64748b; margin-top: 4px;">* 显示名将根据镜像路径自动生成</div>
                        </div>
                    </form>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="hideAddLibraryModal()">取消</button>
                    <button type="button" class="btn btn-primary"
                        onclick="document.getElementById('addLibraryForm').requestSubmit()">保存</button>
                </div>
            </div>
        </div>

        <!-- 登录遮罩 -->
        <div id="loginOverlay">
            <div class="login-card">
                <h2 style="margin-bottom: 24px; text-align: center; color: #1890ff;">镜像预热控制台（IPS）</h2>
                <form onsubmit="login(event)">
                    <div class="form-group"><label class="form-label">用户名</label><input type="text" id="loginUser"
                            class="form-input" required autofocus></div>
                    <div class="form-group"><label class="form-label">密码</label><input type="password" id="loginPass"
                            class="form-input" required></div><button type="submit" class="btn btn-primary"
                        style="width: 100%; padding: 12px; margin-top: 10px; font-size: 16px;">立即登录</button>
                </form>
            </div>
        </div>
        <!-- 创建用户模态框 -->
        <div id="createUserModal" class="modal">
            <div class="modal-content" style="height: auto; width: 400px; max-width: 90vw;">
                <div class="modal-header">添加新用户</div>
                <div class="modal-body">
                    <form id="createUserForm" onsubmit="createUser(event)">
                        <div class="form-group"><label class="form-label">用户名 *</label><input type="text"
                                id="newUsername" class="form-input" required></div>
                        <div class="form-group"><label class="form-label">密码 *</label><input type="password"
                                id="newPassword" class="form-input" required></div>
                        <div class="form-group"><label class="form-label">角色</label><select id="newRole"
                                class="form-input">
                                <option value="viewer">观察员 (Viewer)</option>
                                <option value="admin">管理员 (Admin)</option>
                            </select></div>
                    </form>
                </div>
                <div class="form-actions"><button type="button" class="btn btn-secondary"
                        onclick="hideCreateUserModal()">取消</button><button type="button" class="btn btn-primary"
                        onclick="document.getElementById('createUserForm').requestSubmit()">确认创建</button>
                </div>
            </div>
        </div>
        <!-- 修改密码模态框 -->
        <div id="changePasswordModal" class="modal">
            <div class="modal-content" style="height: auto; width: 400px; max-width: 90vw;">
                <div class="modal-header">修改密码</div>
                <div class="modal-body">
                    <form id="changePasswordForm" onsubmit="changePassword(event)">
                        <input type="hidden" id="pwTargetUserId">
                        <div class="form-group">
                            <label class="form-label">目标用户</label>
                            <input type="text" id="pwTargetUsername" class="form-input" disabled>
                        </div>
                        <div class="form-group">
                            <label class="form-label">新密码 * (至少6位)</label>
                            <input type="password" id="pwNewPassword" class="form-input" required minlength="6">
                        </div>
                        <div class="form-group">
                            <label class="form-label">确认新密码 *</label>
                            <input type="password" id="pwConfirmPassword" class="form-input" required minlength="6">
                        </div>
                    </form>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="hideChangePasswordModal()">取消</button>
                    <button type="button" class="btn btn-primary"
                        onclick="document.getElementById('changePasswordForm').requestSubmit()">保存</button>
                </div>
            </div>
        </div>
        <!-- Confirm Modal -->
        <div id="confirmModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <span id="confirmTitle">确认</span>
                    <span style="font-size: 24px; color: #9ca3af; cursor: pointer;"
                        onclick="hideConfirmModal()">×</span>
                </div>
                <div class="modal-body">
                    <p id="confirmMessage" style="color: #4b5563; font-size: 14px;">Are you sure?</p>
                </div>
                <div class="modal-footer"
                    style="padding: 16px 24px; border-top: 1px solid #e5e7eb; display: flex; justify-content: flex-end; gap: 12px;">
                    <button class="btn btn-secondary" onclick="hideConfirmModal()">取消</button>
                    <button id="confirmBtnAction" class="btn btn-primary">确定</button>
                </div>
            </div>
        </div>

        <!-- Toast Container -->
        <div id="toastContainer" class="toast-container"></div>

        <script src="app.js?v=2.0.1"></script>
</body>

</html>