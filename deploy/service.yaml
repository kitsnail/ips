---
apiVersion: v1
kind: Service
metadata:
  name: ips-apiserver
  namespace: ips
  labels:
    app: ips
    component: apiserver
  annotations:
    # MetalLB annotations (optional)
    # metallb.universe.tf/address-pool: default
    metallb.universe.tf/loadBalancerIPs: 192.168.3.107
spec:
  type: LoadBalancer
  selector:
    app: ips
    component: apiserver
  ports:
    - name: http
      port: 8080
      targetPort: http
      protocol: TCP
  # Session affinity: ensure requests from same client route to same pod
  # This is important for multi-replica deployments using in-memory storage
  sessionAffinity: ClientIP
  sessionAffinityConfig:
    clientIP:
      timeoutSeconds: 10800 # 3 hours
  # Optional: specify external traffic policy
  externalTrafficPolicy: Cluster
